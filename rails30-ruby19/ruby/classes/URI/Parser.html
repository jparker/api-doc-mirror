<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>URI::Parser</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            URI::Parser 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/uri/common_rb.html">lib/uri/common.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M003911">escape</a>,</li>
                
                <li><a href="#M003909">extract</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M003914">initialize_pattern</a>,</li>
                
                <li><a href="#M003915">initialize_regexp</a>,</li>
                
                <li><a href="#M003913">inspect</a></li>
                
            </ul>
        </dd>
    
        <dt>J</dt>
        <dd>
            <ul>
                
                <li><a href="#M003908">join</a></li>
                
            </ul>
        </dd>
    
        <dt>M</dt>
        <dd>
            <ul>
                
                <li><a href="#M003910">make_regexp</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M003905">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M003907">parse</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M003906">split</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M003912">unescape</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="../URI.html">URI</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>pattern</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>regexp</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M003905">
                    
                    <a name="M003905"></a><b>new</b>(opts = {})
                    
                </div>
                
                <div class="description">
                  <h2>Synopsis</h2>
<pre>
  URI::Parser.new([opts])
</pre>
<h2>Args</h2>
<p>
The constructor accepts a hash as options for parser. Keys of options are
pattern names of <a href="../URI.html">URI</a> components and values of
options are pattern strings. The constructor generetes set of regexps for
parsing URIs.
</p>
<p>
You can use the following keys:
</p>
<pre>
  * &lt;tt&gt;:ESCAPED&lt;/tt&gt; (URI::PATTERN::ESCAPED in default)
  * &lt;tt&gt;:UNRESERVED&lt;/tt&gt; (URI::PATTERN::UNRESERVED in default)
  * &lt;tt&gt;:DOMLABEL&lt;/tt&gt; (URI::PATTERN::DOMLABEL in default)
  * &lt;tt&gt;:TOPLABEL&lt;/tt&gt; (URI::PATTERN::TOPLABEL in default)
  * &lt;tt&gt;:HOSTNAME&lt;/tt&gt; (URI::PATTERN::HOSTNAME in default)
</pre>
<h2>Examples</h2>
<pre>
  p = URI::Parser.new(:ESCPAED =&gt; &quot;(?:%[a-fA-F0-9]{2}|%u[a-fA-F0-9]{4})&quot;
  u = p.parse(&quot;http://example.jp/%uABCD&quot;) #=&gt; #&lt;URI::HTTP:0xb78cf4f8 URL:http://example.jp/%uABCD&gt;
  URI.parse(u.to_s) #=&gt; raises URI::InvalidURIError

  s = &quot;http://examle.com/ABCD&quot;
  u1 = p.parse(s) #=&gt; #&lt;URI::HTTP:0xb78c3220 URL:http://example.com/ABCD&gt;
  u2 = URI.parse(s) #=&gt; #&lt;URI::HTTP:0xb78b6d54 URL:http://example.com/ABCD&gt;
  u1 == u2 #=&gt; true
  u1.eql?(u2) #=&gt; false
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003905_source')" id="l_M003905_source">show</a>
                        
                    </p>
                    <div id="M003905_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/uri/common.rb, line 89</span>
89:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">opts</span> = {})
90:       <span class="ruby-ivar">@pattern</span> = <span class="ruby-identifier">initialize_pattern</span>(<span class="ruby-identifier">opts</span>)
91:       <span class="ruby-ivar">@pattern</span>.<span class="ruby-identifier">each_value</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">freeze</span>}
92:       <span class="ruby-ivar">@pattern</span>.<span class="ruby-identifier">freeze</span>
93: 
94:       <span class="ruby-ivar">@regexp</span> = <span class="ruby-identifier">initialize_regexp</span>(<span class="ruby-ivar">@pattern</span>)
95:       <span class="ruby-ivar">@regexp</span>.<span class="ruby-identifier">each_value</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">freeze</span>}
96:       <span class="ruby-ivar">@regexp</span>.<span class="ruby-identifier">freeze</span>
97:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M003911">
                    
                    <a name="M003911"></a><b>escape</b>(str, unsafe = @regexp[:UNSAFE])
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003911_source')" id="l_M003911_source">show</a>
                        
                    </p>
                    <div id="M003911_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 214</span>
214:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">unsafe</span> = <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:UNSAFE</span>])
215:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">unsafe</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Regexp</span>)
216:         <span class="ruby-comment cmt"># perhaps unsafe is String object</span>
217:         <span class="ruby-identifier">unsafe</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;[#{Regexp.quote(unsafe)}]&quot;</span>, <span class="ruby-keyword kw">false</span>)
218:       <span class="ruby-keyword kw">end</span>
219:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">unsafe</span>) <span class="ruby-keyword kw">do</span>
220:         <span class="ruby-identifier">us</span> = <span class="ruby-identifier">$&amp;</span>
221:         <span class="ruby-identifier">tmp</span> = <span class="ruby-value str">''</span>
222:         <span class="ruby-identifier">us</span>.<span class="ruby-identifier">each_byte</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uc</span><span class="ruby-operator">|</span>
223:           <span class="ruby-identifier">tmp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-value str">'%%%02X'</span>, <span class="ruby-identifier">uc</span>)
224:         <span class="ruby-keyword kw">end</span>
225:         <span class="ruby-identifier">tmp</span>
226:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">US_ASCII</span>)
227:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003909">
                    
                    <a name="M003909"></a><b>extract</b>(str, schemes = nil, &amp;block)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003909_source')" id="l_M003909_source">show</a>
                        
                    </p>
                    <div id="M003909_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 195</span>
195:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extract</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">schemes</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
196:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
197:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">make_regexp</span>(<span class="ruby-identifier">schemes</span>)) { <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">$&amp;</span> }
198:         <span class="ruby-keyword kw">nil</span>
199:       <span class="ruby-keyword kw">else</span>
200:         <span class="ruby-identifier">result</span> = []
201:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">make_regexp</span>(<span class="ruby-identifier">schemes</span>)) { <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">$&amp;</span> }
202:         <span class="ruby-identifier">result</span>
203:       <span class="ruby-keyword kw">end</span>
204:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003913">
                    
                    <a name="M003913"></a><b>inspect</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003913_source')" id="l_M003913_source">show</a>
                        
                    </p>
                    <div id="M003913_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 234</span>
234:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>
235:       <span class="ruby-ivar">@@to_s</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">call</span>
236:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003908">
                    
                    <a name="M003908"></a><b>join</b>(*str)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003908_source')" id="l_M003908_source">show</a>
                        
                    </p>
                    <div id="M003908_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 187</span>
187:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">str</span>)
188:       <span class="ruby-identifier">u</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>])
189:       <span class="ruby-identifier">str</span>[<span class="ruby-value">1</span> <span class="ruby-operator">..</span> <span class="ruby-value">-1</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
190:         <span class="ruby-identifier">u</span> = <span class="ruby-identifier">u</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">x</span>)
191:       <span class="ruby-keyword kw">end</span>
192:       <span class="ruby-identifier">u</span>
193:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003910">
                    
                    <a name="M003910"></a><b>make_regexp</b>(schemes = nil)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003910_source')" id="l_M003910_source">show</a>
                        
                    </p>
                    <div id="M003910_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 206</span>
206:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_regexp</span>(<span class="ruby-identifier">schemes</span> = <span class="ruby-keyword kw">nil</span>)
207:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">schemes</span>
208:         <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:ABS_URI_REF</span>]
209:       <span class="ruby-keyword kw">else</span>
210:         <span class="ruby-node">/(?=#{Regexp.union(*schemes)}:)#{@pattern[:X_ABS_URI]}/</span><span class="ruby-identifier">x</span>
211:       <span class="ruby-keyword kw">end</span>
212:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003907">
                    
                    <a name="M003907"></a><b>parse</b>(uri)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003907_source')" id="l_M003907_source">show</a>
                        
                    </p>
                    <div id="M003907_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 172</span>
172:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse</span>(<span class="ruby-identifier">uri</span>)
173:       <span class="ruby-identifier">scheme</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,
174:         <span class="ruby-identifier">registry</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opaque</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">fragment</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">uri</span>)
175: 
176:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scheme</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">URI</span>.<span class="ruby-identifier">scheme_list</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">upcase</span>)
177:         <span class="ruby-constant">URI</span>.<span class="ruby-identifier">scheme_list</span>[<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">upcase</span>].<span class="ruby-identifier">new</span>(<span class="ruby-identifier">scheme</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,
178:                                            <span class="ruby-identifier">registry</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opaque</span>, <span class="ruby-identifier">query</span>,
179:                                            <span class="ruby-identifier">fragment</span>, <span class="ruby-keyword kw">self</span>)
180:       <span class="ruby-keyword kw">else</span>
181:         <span class="ruby-constant">Generic</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">scheme</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,
182:                    <span class="ruby-identifier">registry</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opaque</span>, <span class="ruby-identifier">query</span>,
183:                    <span class="ruby-identifier">fragment</span>, <span class="ruby-keyword kw">self</span>)
184:       <span class="ruby-keyword kw">end</span>
185:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003906">
                    
                    <a name="M003906"></a><b>split</b>(uri)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003906_source')" id="l_M003906_source">show</a>
                        
                    </p>
                    <div id="M003906_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 100</span>
100:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">split</span>(<span class="ruby-identifier">uri</span>)
101:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">uri</span>
102:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">''</span>
103:         <span class="ruby-comment cmt"># null uri</span>
104: 
105:       <span class="ruby-keyword kw">when</span> <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:ABS_URI</span>]
106:         <span class="ruby-identifier">scheme</span>, <span class="ruby-identifier">opaque</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,
107:           <span class="ruby-identifier">registry</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">fragment</span> = <span class="ruby-identifier">$~</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
108: 
109:         <span class="ruby-comment cmt"># URI-reference = [ absoluteURI | relativeURI ] [ &quot;#&quot; fragment ]</span>
110: 
111:         <span class="ruby-comment cmt"># absoluteURI   = scheme &quot;:&quot; ( hier_part | opaque_part )</span>
112:         <span class="ruby-comment cmt"># hier_part     = ( net_path | abs_path ) [ &quot;?&quot; query ]</span>
113:         <span class="ruby-comment cmt"># opaque_part   = uric_no_slash *uric</span>
114: 
115:         <span class="ruby-comment cmt"># abs_path      = &quot;/&quot;  path_segments</span>
116:         <span class="ruby-comment cmt"># net_path      = &quot;//&quot; authority [ abs_path ]</span>
117: 
118:         <span class="ruby-comment cmt"># authority     = server | reg_name</span>
119:         <span class="ruby-comment cmt"># server        = [ [ userinfo &quot;@&quot; ] hostport ]</span>
120: 
121:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scheme</span>
122:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidURIError</span>,
123:             <span class="ruby-node">&quot;bad URI(absolute but no scheme): #{uri}&quot;</span>
124:         <span class="ruby-keyword kw">end</span>
125:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opaque</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">path</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">host</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">registry</span>))
126:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidURIError</span>,
127:             <span class="ruby-node">&quot;bad URI(absolute but no path): #{uri}&quot;</span>
128:         <span class="ruby-keyword kw">end</span>
129: 
130:       <span class="ruby-keyword kw">when</span> <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:REL_URI</span>]
131:         <span class="ruby-identifier">scheme</span> = <span class="ruby-keyword kw">nil</span>
132:         <span class="ruby-identifier">opaque</span> = <span class="ruby-keyword kw">nil</span>
133: 
134:         <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">registry</span>,
135:           <span class="ruby-identifier">rel_segment</span>, <span class="ruby-identifier">abs_path</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">fragment</span> = <span class="ruby-identifier">$~</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
136:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rel_segment</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">abs_path</span>
137:           <span class="ruby-identifier">path</span> = <span class="ruby-identifier">rel_segment</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">abs_path</span>
138:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">rel_segment</span>
139:           <span class="ruby-identifier">path</span> = <span class="ruby-identifier">rel_segment</span>
140:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">abs_path</span>
141:           <span class="ruby-identifier">path</span> = <span class="ruby-identifier">abs_path</span>
142:         <span class="ruby-keyword kw">end</span>
143: 
144:         <span class="ruby-comment cmt"># URI-reference = [ absoluteURI | relativeURI ] [ &quot;#&quot; fragment ]</span>
145: 
146:         <span class="ruby-comment cmt"># relativeURI   = ( net_path | abs_path | rel_path ) [ &quot;?&quot; query ]</span>
147: 
148:         <span class="ruby-comment cmt"># net_path      = &quot;//&quot; authority [ abs_path ]</span>
149:         <span class="ruby-comment cmt"># abs_path      = &quot;/&quot;  path_segments</span>
150:         <span class="ruby-comment cmt"># rel_path      = rel_segment [ abs_path ]</span>
151: 
152:         <span class="ruby-comment cmt"># authority     = server | reg_name</span>
153:         <span class="ruby-comment cmt"># server        = [ [ userinfo &quot;@&quot; ] hostport ]</span>
154: 
155:       <span class="ruby-keyword kw">else</span>
156:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidURIError</span>, <span class="ruby-node">&quot;bad URI(is not URI?): #{uri}&quot;</span>
157:       <span class="ruby-keyword kw">end</span>
158: 
159:       <span class="ruby-identifier">path</span> = <span class="ruby-value str">''</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">path</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opaque</span> <span class="ruby-comment cmt"># (see RFC2396 Section 5.2)</span>
160:       <span class="ruby-identifier">ret</span> = [
161:         <span class="ruby-identifier">scheme</span>,
162:         <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>,         <span class="ruby-comment cmt"># X</span>
163:         <span class="ruby-identifier">registry</span>,                     <span class="ruby-comment cmt"># X</span>
164:         <span class="ruby-identifier">path</span>,                         <span class="ruby-comment cmt"># Y</span>
165:         <span class="ruby-identifier">opaque</span>,                       <span class="ruby-comment cmt"># Y</span>
166:         <span class="ruby-identifier">query</span>,
167:         <span class="ruby-identifier">fragment</span>
168:       ]
169:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ret</span>
170:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003912">
                    
                    <a name="M003912"></a><b>unescape</b>(str, escaped = @regexp[:ESCAPED])
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003912_source')" id="l_M003912_source">show</a>
                        
                    </p>
                    <div id="M003912_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 229</span>
229:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">escaped</span> = <span class="ruby-ivar">@regexp</span>[<span class="ruby-identifier">:ESCAPED</span>])
230:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">escaped</span>) { [<span class="ruby-identifier">$&amp;</span>[<span class="ruby-value">1</span>, <span class="ruby-value">2</span>].<span class="ruby-identifier">hex</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'C'</span>) }.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span>)
231:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M003914">
                    
                    <a name="M003914"></a><b>initialize_pattern</b>(opts = {})
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003914_source')" id="l_M003914_source">show</a>
                        
                    </p>
                    <div id="M003914_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 240</span>
240:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_pattern</span>(<span class="ruby-identifier">opts</span> = {})
241:       <span class="ruby-identifier">ret</span> = {}
242:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ESCAPED</span>] = <span class="ruby-identifier">escaped</span> = (<span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:ESCAPED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">ESCAPED</span>)
243:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:UNRESERVED</span>] = <span class="ruby-identifier">unreserved</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:UNRESERVED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">UNRESERVED</span>
244:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:RESERVED</span>] = <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:RESERVED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">RESERVED</span>
245:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:DOMLABEL</span>] = <span class="ruby-identifier">domlabel</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:DOMLABEL</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">DOMLABEL</span>
246:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:TOPLABEL</span>] = <span class="ruby-identifier">toplabel</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:TOPLABEL</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">TOPLABEL</span>
247:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTNAME</span>] = <span class="ruby-identifier">hostname</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:HOSTNAME</span>)
248: 
249:       <span class="ruby-comment cmt"># RFC 2396 (URI Generic Syntax)</span>
250:       <span class="ruby-comment cmt"># RFC 2732 (IPv6 Literal Addresses in URL's)</span>
251:       <span class="ruby-comment cmt"># RFC 2373 (IPv6 Addressing Architecture)</span>
252: 
253:       <span class="ruby-comment cmt"># uric          = reserved | unreserved | escaped</span>
254:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URIC</span>] = <span class="ruby-identifier">uric</span> = <span class="ruby-node">&quot;(?:[#{unreserved}#{reserved}]|#{escaped})&quot;</span>
255:       <span class="ruby-comment cmt"># uric_no_slash = unreserved | escaped | &quot;;&quot; | &quot;?&quot; | &quot;:&quot; | &quot;@&quot; |</span>
256:       <span class="ruby-comment cmt">#                 &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot;</span>
257:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URIC_NO_SLASH</span>] = <span class="ruby-identifier">uric_no_slash</span> = <span class="ruby-node">&quot;(?:[#{unreserved};?:@&amp;=+$,]|#{escaped})&quot;</span>
258:       <span class="ruby-comment cmt"># query         = *uric</span>
259:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:QUERY</span>] = <span class="ruby-identifier">query</span> = <span class="ruby-node">&quot;#{uric}*&quot;</span>
260:       <span class="ruby-comment cmt"># fragment      = *uric</span>
261:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:FRAGMENT</span>] = <span class="ruby-identifier">fragment</span> = <span class="ruby-node">&quot;#{uric}*&quot;</span>
262: 
263:       <span class="ruby-comment cmt"># hostname      = *( domainlabel &quot;.&quot; ) toplabel [ &quot;.&quot; ]</span>
264:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">hostname</span>
265:         <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTNAME</span>] = <span class="ruby-identifier">hostname</span> = <span class="ruby-node">&quot;(?:#{domlabel}\\.)*#{toplabel}\\.?&quot;</span>
266:       <span class="ruby-keyword kw">end</span>
267: 
268:       <span class="ruby-comment cmt"># RFC 2373, APPENDIX B:</span>
269:       <span class="ruby-comment cmt"># IPv6address = hexpart [ &quot;:&quot; IPv4address ]</span>
270:       <span class="ruby-comment cmt"># IPv4address   = 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT</span>
271:       <span class="ruby-comment cmt"># hexpart = hexseq | hexseq &quot;::&quot; [ hexseq ] | &quot;::&quot; [ hexseq ]</span>
272:       <span class="ruby-comment cmt"># hexseq  = hex4 *( &quot;:&quot; hex4)</span>
273:       <span class="ruby-comment cmt"># hex4    = 1*4HEXDIG</span>
274:       <span class="ruby-comment cmt">#</span>
275:       <span class="ruby-comment cmt"># XXX: This definition has a flaw. &quot;::&quot; + IPv4address must be</span>
276:       <span class="ruby-comment cmt"># allowed too.  Here is a replacement.</span>
277:       <span class="ruby-comment cmt">#</span>
278:       <span class="ruby-comment cmt"># IPv4address = 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT</span>
279:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV4ADDR</span>] = <span class="ruby-identifier">ipv4addr</span> = <span class="ruby-value str">&quot;\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}&quot;</span>
280:       <span class="ruby-comment cmt"># hex4     = 1*4HEXDIG</span>
281:       <span class="ruby-identifier">hex4</span> = <span class="ruby-node">&quot;[#{PATTERN::HEX}]{1,4}&quot;</span>
282:       <span class="ruby-comment cmt"># lastpart = hex4 | IPv4address</span>
283:       <span class="ruby-identifier">lastpart</span> = <span class="ruby-node">&quot;(?:#{hex4}|#{ipv4addr})&quot;</span>
284:       <span class="ruby-comment cmt"># hexseq1  = *( hex4 &quot;:&quot; ) hex4</span>
285:       <span class="ruby-identifier">hexseq1</span> = <span class="ruby-node">&quot;(?:#{hex4}:)*#{hex4}&quot;</span>
286:       <span class="ruby-comment cmt"># hexseq2  = *( hex4 &quot;:&quot; ) lastpart</span>
287:       <span class="ruby-identifier">hexseq2</span> = <span class="ruby-node">&quot;(?:#{hex4}:)*#{lastpart}&quot;</span>
288:       <span class="ruby-comment cmt"># IPv6address = hexseq2 | [ hexseq1 ] &quot;::&quot; [ hexseq2 ]</span>
289:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV6ADDR</span>] = <span class="ruby-identifier">ipv6addr</span> = <span class="ruby-node">&quot;(?:#{hexseq2}|(?:#{hexseq1})?::(?:#{hexseq2})?)&quot;</span>
290: 
291:       <span class="ruby-comment cmt"># IPv6prefix  = ( hexseq1 | [ hexseq1 ] &quot;::&quot; [ hexseq1 ] ) &quot;/&quot; 1*2DIGIT</span>
292:       <span class="ruby-comment cmt"># unused</span>
293: 
294:       <span class="ruby-comment cmt"># ipv6reference = &quot;[&quot; IPv6address &quot;]&quot; (RFC 2732)</span>
295:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV6REF</span>] = <span class="ruby-identifier">ipv6ref</span> = <span class="ruby-node">&quot;\\[#{ipv6addr}\\]&quot;</span>
296: 
297:       <span class="ruby-comment cmt"># host          = hostname | IPv4address</span>
298:       <span class="ruby-comment cmt"># host          = hostname | IPv4address | IPv6reference (RFC 2732)</span>
299:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOST</span>] = <span class="ruby-identifier">host</span> = <span class="ruby-node">&quot;(?:#{hostname}|#{ipv4addr}|#{ipv6ref})&quot;</span>
300:       <span class="ruby-comment cmt"># port          = *digit</span>
301:       <span class="ruby-identifier">port</span> = <span class="ruby-value str">'\d*'</span>
302:       <span class="ruby-comment cmt"># hostport      = host [ &quot;:&quot; port ]</span>
303:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTPORT</span>] = <span class="ruby-identifier">hostport</span> = <span class="ruby-node">&quot;#{host}(?::#{port})?&quot;</span>
304: 
305:       <span class="ruby-comment cmt"># userinfo      = *( unreserved | escaped |</span>
306:       <span class="ruby-comment cmt">#                    &quot;;&quot; | &quot;:&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot; )</span>
307:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:USERINFO</span>] = <span class="ruby-identifier">userinfo</span> = <span class="ruby-node">&quot;(?:[#{unreserved};:&amp;=+$,]|#{escaped})*&quot;</span>
308: 
309:       <span class="ruby-comment cmt"># pchar         = unreserved | escaped |</span>
310:       <span class="ruby-comment cmt">#                 &quot;:&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot;</span>
311:       <span class="ruby-identifier">pchar</span> = <span class="ruby-node">&quot;(?:[#{unreserved}:@&amp;=+$,]|#{escaped})&quot;</span>
312:       <span class="ruby-comment cmt"># param         = *pchar</span>
313:       <span class="ruby-identifier">param</span> = <span class="ruby-node">&quot;#{pchar}*&quot;</span>
314:       <span class="ruby-comment cmt"># segment       = *pchar *( &quot;;&quot; param )</span>
315:       <span class="ruby-identifier">segment</span> = <span class="ruby-node">&quot;#{pchar}*(?:;#{param})*&quot;</span>
316:       <span class="ruby-comment cmt"># path_segments = segment *( &quot;/&quot; segment )</span>
317:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:PATH_SEGMENTS</span>] = <span class="ruby-identifier">path_segments</span> = <span class="ruby-node">&quot;#{segment}(?:/#{segment})*&quot;</span>
318: 
319:       <span class="ruby-comment cmt"># server        = [ [ userinfo &quot;@&quot; ] hostport ]</span>
320:       <span class="ruby-identifier">server</span> = <span class="ruby-node">&quot;(?:#{userinfo}@)?#{hostport}&quot;</span>
321:       <span class="ruby-comment cmt"># reg_name      = 1*( unreserved | escaped | &quot;$&quot; | &quot;,&quot; |</span>
322:       <span class="ruby-comment cmt">#                     &quot;;&quot; | &quot;:&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; )</span>
323:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REG_NAME</span>] = <span class="ruby-identifier">reg_name</span> = <span class="ruby-node">&quot;(?:[#{unreserved}$,;:@&amp;=+]|#{escaped})+&quot;</span>
324:       <span class="ruby-comment cmt"># authority     = server | reg_name</span>
325:       <span class="ruby-identifier">authority</span> = <span class="ruby-node">&quot;(?:#{server}|#{reg_name})&quot;</span>
326: 
327:       <span class="ruby-comment cmt"># rel_segment   = 1*( unreserved | escaped |</span>
328:       <span class="ruby-comment cmt">#                     &quot;;&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot; )</span>
329:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_SEGMENT</span>] = <span class="ruby-identifier">rel_segment</span> = <span class="ruby-node">&quot;(?:[#{unreserved};@&amp;=+$,]|#{escaped})+&quot;</span>
330: 
331:       <span class="ruby-comment cmt"># scheme        = alpha *( alpha | digit | &quot;+&quot; | &quot;-&quot; | &quot;.&quot; )</span>
332:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:SCHEME</span>] = <span class="ruby-identifier">scheme</span> = <span class="ruby-node">&quot;[#{PATTERN::ALPHA}][-+.#{PATTERN::ALPHA}\\d]*&quot;</span>
333: 
334:       <span class="ruby-comment cmt"># abs_path      = &quot;/&quot;  path_segments</span>
335:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_PATH</span>] = <span class="ruby-identifier">abs_path</span> = <span class="ruby-node">&quot;/#{path_segments}&quot;</span>
336:       <span class="ruby-comment cmt"># rel_path      = rel_segment [ abs_path ]</span>
337:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_PATH</span>] = <span class="ruby-identifier">rel_path</span> = <span class="ruby-node">&quot;#{rel_segment}(?:#{abs_path})?&quot;</span>
338:       <span class="ruby-comment cmt"># net_path      = &quot;//&quot; authority [ abs_path ]</span>
339:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:NET_PATH</span>] = <span class="ruby-identifier">net_path</span> = <span class="ruby-node">&quot;//#{authority}(?:#{abs_path})?&quot;</span>
340: 
341:       <span class="ruby-comment cmt"># hier_part     = ( net_path | abs_path ) [ &quot;?&quot; query ]</span>
342:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HIER_PART</span>] = <span class="ruby-identifier">hier_part</span> = <span class="ruby-node">&quot;(?:#{net_path}|#{abs_path})(?:\\?(?:#{query}))?&quot;</span>
343:       <span class="ruby-comment cmt"># opaque_part   = uric_no_slash *uric</span>
344:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:OPAQUE_PART</span>] = <span class="ruby-identifier">opaque_part</span> = <span class="ruby-node">&quot;#{uric_no_slash}#{uric}*&quot;</span>
345: 
346:       <span class="ruby-comment cmt"># absoluteURI   = scheme &quot;:&quot; ( hier_part | opaque_part )</span>
347:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_URI</span>] = <span class="ruby-identifier">abs_uri</span> = <span class="ruby-node">&quot;#{scheme}:(?:#{hier_part}|#{opaque_part})&quot;</span>
348:       <span class="ruby-comment cmt"># relativeURI   = ( net_path | abs_path | rel_path ) [ &quot;?&quot; query ]</span>
349:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_URI</span>] = <span class="ruby-identifier">rel_uri</span> = <span class="ruby-node">&quot;(?:#{net_path}|#{abs_path}|#{rel_path})(?:\\?#{query})?&quot;</span>
350: 
351:       <span class="ruby-comment cmt"># URI-reference = [ absoluteURI | relativeURI ] [ &quot;#&quot; fragment ]</span>
352:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URI_REF</span>] = <span class="ruby-identifier">uri_ref</span> = <span class="ruby-node">&quot;(?:#{abs_uri}|#{rel_uri})?(?:##{fragment})?&quot;</span>
353: 
354:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:X_ABS_URI</span>] = <span class="ruby-node">&quot;
355:         (#{scheme}):                           (?# 1: scheme)
356:         (?:
357:            (#{opaque_part})                    (?# 2: opaque)
358:         |
359:            (?:(?:
360:              //(?:
361:                  (?:(?:(#{userinfo})@)?        (?# 3: userinfo)
362:                    (?:(#{host})(?::(\\d*))?))? (?# 4: host, 5: port)
363:                |
364:                  (#{reg_name})                 (?# 6: registry)
365:                )
366:              |
367:              (?!//))                           (?# XXX: '//' is the mark for hostport)
368:              (#{abs_path})?                    (?# 7: path)
369:            )(?:\\?(#{query}))?                 (?# 8: query)
370:         )
371:         (?:\\#(#{fragment}))?                  (?# 9: fragment)
372:       &quot;</span>
373: 
374:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:X_REL_URI</span>] = <span class="ruby-node">&quot;
375:         (?:
376:           (?:
377:             //
378:             (?:
379:               (?:(#{userinfo})@)?       (?# 1: userinfo)
380:                 (#{host})?(?::(\\d*))?  (?# 2: host, 3: port)
381:             |
382:               (#{reg_name})             (?# 4: registry)
383:             )
384:           )
385:         |
386:           (#{rel_segment})              (?# 5: rel_segment)
387:         )?
388:         (#{abs_path})?                  (?# 6: abs_path)
389:         (?:\\?(#{query}))?              (?# 7: query)
390:         (?:\\#(#{fragment}))?           (?# 8: fragment)
391:       &quot;</span>
392: 
393:       <span class="ruby-identifier">ret</span>
394:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M003915">
                    
                    <a name="M003915"></a><b>initialize_regexp</b>(pattern)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M003915_source')" id="l_M003915_source">show</a>
                        
                    </p>
                    <div id="M003915_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 396</span>
396:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_regexp</span>(<span class="ruby-identifier">pattern</span>)
397:       <span class="ruby-identifier">ret</span> = {}
398: 
399:       <span class="ruby-comment cmt"># for URI::split</span>
400:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_URI</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'\A\s*'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:X_ABS_URI</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">'\s*\z'</span>, <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>)
401:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_URI</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'\A\s*'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:X_REL_URI</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">'\s*\z'</span>, <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>)
402: 
403:       <span class="ruby-comment cmt"># for URI::extract</span>
404:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URI_REF</span>]     = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:URI_REF</span>])
405:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_URI_REF</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:X_ABS_URI</span>], <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>)
406:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_URI_REF</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:X_REL_URI</span>], <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>)
407: 
408:       <span class="ruby-comment cmt"># for URI::escape/unescape</span>
409:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ESCAPED</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>[<span class="ruby-identifier">:ESCAPED</span>])
410:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:UNSAFE</span>]  = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;[^#{pattern[:UNRESERVED]}#{pattern[:RESERVED]}]&quot;</span>)
411: 
412:       <span class="ruby-comment cmt"># for Generic#initialize</span>
413:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:SCHEME</span>]   = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:SCHEME]}$&quot;</span>)
414:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:USERINFO</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:USERINFO]}$&quot;</span>)
415:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOST</span>]     = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:HOST]}$&quot;</span>)
416:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:PORT</span>]     = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:PORT]}$&quot;</span>)
417:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:OPAQUE</span>]   = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:OPAQUE_PART]}$&quot;</span>)
418:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REGISTRY</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:REG_NAME]}$&quot;</span>)
419:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_PATH</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:ABS_PATH]}$&quot;</span>)
420:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_PATH</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:REL_PATH]}$&quot;</span>)
421:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:QUERY</span>]    = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:QUERY]}$&quot;</span>)
422:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:FRAGMENT</span>] = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^#{pattern[:FRAGMENT]}$&quot;</span>)
423: 
424:       <span class="ruby-identifier">ret</span>
425:     <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    