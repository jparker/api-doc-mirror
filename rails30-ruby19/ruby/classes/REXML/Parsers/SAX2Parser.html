<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>REXML::Parsers::SAX2Parser</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            REXML::Parsers::SAX2Parser 
            
                <span class="parent">&lt; 
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/rexml/parsers/sax2parser_rb.html">lib/rexml/parsers/sax2parser.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="SAX2Parser.html">SAX2Parser</a>
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>A</dt>
        <dd>
            <ul>
                
                <li><a href="#M002650">add</a>,</li>
                
                <li><a href="#M002643">add_listener</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M002645">deafen</a></li>
                
            </ul>
        </dd>
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M002649">get_listeners</a>,</li>
                
                <li><a href="#M002651">get_namespace</a>,</li>
                
                <li><a href="#M002648">get_procs</a></li>
                
            </ul>
        </dd>
    
        <dt>H</dt>
        <dd>
            <ul>
                
                <li><a href="#M002647">handle</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M002644">listen</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M002641">new</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M002646">parse</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M002642">source</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M002641">
                    
                    <a name="M002641"></a><b>new</b>(source)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002641_source')" id="l_M002641_source">show</a>
                        
                    </p>
                    <div id="M002641_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 10</span>
10:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">source</span>
11:         <span class="ruby-ivar">@parser</span> = <span class="ruby-constant">BaseParser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">source</span>)
12:         <span class="ruby-ivar">@listeners</span> = []
13:         <span class="ruby-ivar">@procs</span> = []
14:         <span class="ruby-ivar">@namespace_stack</span> = []
15:         <span class="ruby-ivar">@has_listeners</span> = <span class="ruby-keyword kw">false</span>
16:         <span class="ruby-ivar">@tag_stack</span> = []
17:         <span class="ruby-ivar">@entities</span> = {}
18:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M002643">
                    
                    <a name="M002643"></a><b>add_listener</b>( listener )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002643_source')" id="l_M002643_source">show</a>
                        
                    </p>
                    <div id="M002643_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 24</span>
24:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_listener</span>( <span class="ruby-identifier">listener</span> )
25:         <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">add_listener</span>( <span class="ruby-identifier">listener</span> )
26:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002645">
                    
                    <a name="M002645"></a><b>deafen</b>( listener=nil, &amp;blok )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002645_source')" id="l_M002645_source">show</a>
                        
                    </p>
                    <div id="M002645_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 76</span>
76:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deafen</span>( <span class="ruby-identifier">listener</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blok</span> )
77:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">listener</span>
78:           <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">listener</span> }
79:           <span class="ruby-ivar">@has_listeners</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
80:         <span class="ruby-keyword kw">else</span>
81:           <span class="ruby-ivar">@procs</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">blok</span> }
82:         <span class="ruby-keyword kw">end</span>
83:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002644">
                    
                    <a name="M002644"></a><b>listen</b>( *args, &amp;blok )
                    
                </div>
                
                <div class="description">
                  <p>
Listen arguments:
</p>
<p>
<a href="../../Symbol.html">Symbol</a>, <a
href="../../Array.html">Array</a>, Block
</p>
<pre>
        Listen to Symbol events on Array elements
</pre>
<p>
<a href="../../Symbol.html">Symbol</a>, Block
</p>
<pre>
  Listen to Symbol events
</pre>
<p>
<a href="../../Array.html">Array</a>, Listener
</p>
<pre>
        Listen to all events on Array elements
</pre>
<p>
<a href="../../Array.html">Array</a>, Block
</p>
<pre>
        Listen to :start_element events on Array elements
</pre>
<p>
Listener
</p>
<pre>
        Listen to All events
</pre>
<p>
<a href="../../Symbol.html">Symbol</a> can be one of: :start_element,
:end_element, :start_prefix_mapping, :end_prefix_mapping, :characters,
:processing_instruction, :doctype, :attlistdecl, :elementdecl, :entitydecl,
:notationdecl, :cdata, :xmldecl, :comment
</p>
<p>
There is an additional symbol that can be listened for: :progress. This
will be called for every event generated, passing in the current stream
position.
</p>
<p>
<a href="../../Array.html">Array</a> contains regular expressions or
strings which will be matched against fully qualified element names.
</p>
<p>
Listener must implement the methods in <a
href="../SAX2Listener.html">SAX2Listener</a>
</p>
<p>
Block will be passed the same arguments as a <a
href="../SAX2Listener.html">SAX2Listener</a> method would be, where the
method name is the same as the matched <a
href="../../Symbol.html">Symbol</a>. See the <a
href="../SAX2Listener.html">SAX2Listener</a> for more information.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002644_source')" id="l_M002644_source">show</a>
                        
                    </p>
                    <div id="M002644_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 58</span>
58:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">listen</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">blok</span> )
59:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">Symbol</span>
60:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
61:             <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@procs</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">match</span>, <span class="ruby-identifier">blok</span>] }
62:           <span class="ruby-keyword kw">else</span>
63:             <span class="ruby-identifier">add</span>( [<span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>], <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">blok</span>] )
64:           <span class="ruby-keyword kw">end</span>
65:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">Array</span>
66:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
67:             <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span> <span class="ruby-identifier">add</span>( [<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">match</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>]] ) }
68:           <span class="ruby-keyword kw">else</span>
69:             <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span> <span class="ruby-identifier">add</span>( [ <span class="ruby-identifier">:start_element</span>, <span class="ruby-identifier">match</span>, <span class="ruby-identifier">blok</span> ] ) }
70:           <span class="ruby-keyword kw">end</span>
71:         <span class="ruby-keyword kw">else</span>
72:           <span class="ruby-identifier">add</span>([<span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]])
73:         <span class="ruby-keyword kw">end</span>
74:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002646">
                    
                    <a name="M002646"></a><b>parse</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002646_source')" id="l_M002646_source">show</a>
                        
                    </p>
                    <div id="M002646_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 85</span>
 85:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse</span>
 86:         <span class="ruby-ivar">@procs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>,<span class="ruby-identifier">match</span>,<span class="ruby-identifier">block</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sym</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:start_document</span> }
 87:         <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>,<span class="ruby-identifier">match</span>,<span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
 88:           <span class="ruby-identifier">block</span>.<span class="ruby-identifier">start_document</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sym</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:start_document</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">sym</span>.<span class="ruby-identifier">nil?</span>
 89:         }
 90:         <span class="ruby-identifier">root</span> = <span class="ruby-identifier">context</span> = []
 91:         <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
 92:           <span class="ruby-identifier">event</span> = <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">pull</span>
 93:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">event</span>[<span class="ruby-value">0</span>]
 94:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:end_document</span>
 95:             <span class="ruby-identifier">handle</span>( <span class="ruby-identifier">:end_document</span> )
 96:             <span class="ruby-keyword kw">break</span>
 97:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:start_doctype</span>
 98:             <span class="ruby-identifier">handle</span>( <span class="ruby-identifier">:doctype</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">event</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
 99:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:end_doctype</span>
100:             <span class="ruby-identifier">context</span> = <span class="ruby-identifier">context</span>[<span class="ruby-value">1</span>]
101:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:start_element</span>
102:             <span class="ruby-ivar">@tag_stack</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>])
103:             <span class="ruby-comment cmt"># find the observers for namespaces</span>
104:             <span class="ruby-identifier">procs</span> = <span class="ruby-identifier">get_procs</span>( <span class="ruby-identifier">:start_prefix_mapping</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
105:             <span class="ruby-identifier">listeners</span> = <span class="ruby-identifier">get_listeners</span>( <span class="ruby-identifier">:start_prefix_mapping</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
106:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procs</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">listeners</span>
107:               <span class="ruby-comment cmt"># break out the namespace declarations</span>
108:               <span class="ruby-comment cmt"># The attributes live in event[2]</span>
109:               <span class="ruby-identifier">event</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">n</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">event</span>[<span class="ruby-value">2</span>][<span class="ruby-identifier">n</span>] = <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">normalize</span>(<span class="ruby-identifier">v</span>)}
110:               <span class="ruby-identifier">nsdecl</span> = <span class="ruby-identifier">event</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">find_all</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">n</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^xmlns(:|$)/</span> }
111:               <span class="ruby-identifier">nsdecl</span>.<span class="ruby-identifier">collect!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">n</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> [ <span class="ruby-identifier">n</span>[<span class="ruby-value">6</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>], <span class="ruby-identifier">value</span> ] }
112:               <span class="ruby-ivar">@namespace_stack</span>.<span class="ruby-identifier">push</span>({})
113:               <span class="ruby-identifier">nsdecl</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
114:                 <span class="ruby-ivar">@namespace_stack</span>[<span class="ruby-value">-1</span>][<span class="ruby-identifier">n</span>] = <span class="ruby-identifier">v</span>
115:                 <span class="ruby-comment cmt"># notify observers of namespaces</span>
116:                 <span class="ruby-identifier">procs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">call</span>( <span class="ruby-identifier">n</span>, <span class="ruby-identifier">v</span> ) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procs</span>
117:                 <span class="ruby-identifier">listeners</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">start_prefix_mapping</span>(<span class="ruby-identifier">n</span>, <span class="ruby-identifier">v</span>) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">listeners</span>
118:               <span class="ruby-keyword kw">end</span>
119:             <span class="ruby-keyword kw">end</span>
120:             <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">=~</span> <span class="ruby-constant">Namespace</span><span class="ruby-operator">::</span><span class="ruby-constant">NAMESPLIT</span>
121:             <span class="ruby-identifier">prefix</span> = <span class="ruby-identifier">$1</span>
122:             <span class="ruby-identifier">local</span> = <span class="ruby-identifier">$2</span>
123:             <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">get_namespace</span>(<span class="ruby-identifier">prefix</span>)
124:             <span class="ruby-comment cmt"># find the observers for start_element</span>
125:             <span class="ruby-identifier">procs</span> = <span class="ruby-identifier">get_procs</span>( <span class="ruby-identifier">:start_element</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
126:             <span class="ruby-identifier">listeners</span> = <span class="ruby-identifier">get_listeners</span>( <span class="ruby-identifier">:start_element</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
127:             <span class="ruby-comment cmt"># notify observers</span>
128:             <span class="ruby-identifier">procs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">call</span>( <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">local</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">event</span>[<span class="ruby-value">2</span>] ) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procs</span>
129:             <span class="ruby-identifier">listeners</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span>
130:               <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">start_element</span>( <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">local</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">event</span>[<span class="ruby-value">2</span>] )
131:             } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">listeners</span>
132:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:end_element</span>
133:             <span class="ruby-ivar">@tag_stack</span>.<span class="ruby-identifier">pop</span>
134:             <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">=~</span> <span class="ruby-constant">Namespace</span><span class="ruby-operator">::</span><span class="ruby-constant">NAMESPLIT</span>
135:             <span class="ruby-identifier">prefix</span> = <span class="ruby-identifier">$1</span>
136:             <span class="ruby-identifier">local</span> = <span class="ruby-identifier">$2</span>
137:             <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">get_namespace</span>(<span class="ruby-identifier">prefix</span>)
138:             <span class="ruby-comment cmt"># find the observers for start_element</span>
139:             <span class="ruby-identifier">procs</span> = <span class="ruby-identifier">get_procs</span>( <span class="ruby-identifier">:end_element</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
140:             <span class="ruby-identifier">listeners</span> = <span class="ruby-identifier">get_listeners</span>( <span class="ruby-identifier">:end_element</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
141:             <span class="ruby-comment cmt"># notify observers</span>
142:             <span class="ruby-identifier">procs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">call</span>( <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">local</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] ) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procs</span>
143:             <span class="ruby-identifier">listeners</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span>
144:               <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">end_element</span>( <span class="ruby-identifier">uri</span>, <span class="ruby-identifier">local</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
145:             } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">listeners</span>
146: 
147:             <span class="ruby-identifier">namespace_mapping</span> = <span class="ruby-ivar">@namespace_stack</span>.<span class="ruby-identifier">pop</span>
148:             <span class="ruby-comment cmt"># find the observers for namespaces</span>
149:             <span class="ruby-identifier">procs</span> = <span class="ruby-identifier">get_procs</span>( <span class="ruby-identifier">:end_prefix_mapping</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
150:             <span class="ruby-identifier">listeners</span> = <span class="ruby-identifier">get_listeners</span>( <span class="ruby-identifier">:end_prefix_mapping</span>, <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] )
151:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procs</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">listeners</span>
152:               <span class="ruby-identifier">namespace_mapping</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ns_prefix</span>, <span class="ruby-identifier">ns_uri</span><span class="ruby-operator">|</span>
153:                 <span class="ruby-comment cmt"># notify observers of namespaces</span>
154:                 <span class="ruby-identifier">procs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">call</span>( <span class="ruby-identifier">ns_prefix</span> ) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procs</span>
155:                 <span class="ruby-identifier">listeners</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">end_prefix_mapping</span>(<span class="ruby-identifier">ns_prefix</span>) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">listeners</span>
156:               <span class="ruby-keyword kw">end</span>
157:             <span class="ruby-keyword kw">end</span>
158:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:text</span>
159:             <span class="ruby-comment cmt">#normalized = @parser.normalize( event[1] )</span>
160:             <span class="ruby-comment cmt">#handle( :characters, normalized )</span>
161:             <span class="ruby-identifier">copy</span> = <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">clone</span>
162: 
163:             <span class="ruby-identifier">esub</span> = <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
164:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@entities</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">$1</span>)
165:                 <span class="ruby-ivar">@entities</span>[<span class="ruby-identifier">$1</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">Text</span><span class="ruby-operator">::</span><span class="ruby-constant">REFERENCE</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">esub</span>)
166:               <span class="ruby-keyword kw">else</span>
167:                 <span class="ruby-identifier">match</span>
168:               <span class="ruby-keyword kw">end</span>
169:             }
170: 
171:             <span class="ruby-identifier">copy</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-constant">Text</span><span class="ruby-operator">::</span><span class="ruby-constant">REFERENCE</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">esub</span> )
172:             <span class="ruby-identifier">copy</span>.<span class="ruby-identifier">gsub!</span>( <span class="ruby-constant">Text</span><span class="ruby-operator">::</span><span class="ruby-constant">NUMERICENTITY</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
173:               <span class="ruby-identifier">m</span>=<span class="ruby-identifier">$1</span>
174:               <span class="ruby-identifier">m</span> = <span class="ruby-node">&quot;0#{m}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?x</span>
175:               [<span class="ruby-constant">Integer</span>(<span class="ruby-identifier">m</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'U*'</span>)
176:             }
177:             <span class="ruby-identifier">handle</span>( <span class="ruby-identifier">:characters</span>, <span class="ruby-identifier">copy</span> )
178:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:entitydecl</span>
179:             <span class="ruby-ivar">@entities</span>[ <span class="ruby-identifier">event</span>[<span class="ruby-value">1</span>] ] = <span class="ruby-identifier">event</span>[<span class="ruby-value">2</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>
180:             <span class="ruby-identifier">handle</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">event</span> )
181:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:processing_instruction</span>, <span class="ruby-identifier">:comment</span>, <span class="ruby-identifier">:attlistdecl</span>,
182:             <span class="ruby-identifier">:elementdecl</span>, <span class="ruby-identifier">:cdata</span>, <span class="ruby-identifier">:notationdecl</span>, <span class="ruby-identifier">:xmldecl</span>
183:             <span class="ruby-identifier">handle</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">event</span> )
184:           <span class="ruby-keyword kw">end</span>
185:           <span class="ruby-identifier">handle</span>( <span class="ruby-identifier">:progress</span>, <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">position</span> )
186:         <span class="ruby-keyword kw">end</span>
187:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002642">
                    
                    <a name="M002642"></a><b>source</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002642_source')" id="l_M002642_source">show</a>
                        
                    </p>
                    <div id="M002642_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 20</span>
20:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">source</span>
21:         <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">source</span>
22:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Private methods</div>
            
            <div class="method">
                <div class="title" id="M002650">
                    
                    <a name="M002650"></a><b>add</b>( pair )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002650_source')" id="l_M002650_source">show</a>
                        
                    </p>
                    <div id="M002650_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 231</span>
231:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add</span>( <span class="ruby-identifier">pair</span> )
232:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pair</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:call</span>
233:           <span class="ruby-ivar">@procs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">pair</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@procs</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">pair</span>
234:         <span class="ruby-keyword kw">else</span>
235:           <span class="ruby-ivar">@listeners</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">pair</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">pair</span>
236:           <span class="ruby-ivar">@has_listeners</span> = <span class="ruby-keyword kw">true</span>
237:         <span class="ruby-keyword kw">end</span>
238:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002649">
                    
                    <a name="M002649"></a><b>get_listeners</b>( symbol, name )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002649_source')" id="l_M002649_source">show</a>
                        
                    </p>
                    <div id="M002649_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 217</span>
217:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_listeners</span>( <span class="ruby-identifier">symbol</span>, <span class="ruby-identifier">name</span> )
218:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
219:         <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">find_all</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>, <span class="ruby-identifier">match</span>, <span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
220:           (
221:             (<span class="ruby-identifier">sym</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">symbol</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">sym</span>) <span class="ruby-keyword kw">and</span>
222:             ((<span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> (
223:               (<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">match</span>) <span class="ruby-keyword kw">or</span>
224:               (<span class="ruby-identifier">match</span>.<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">Regexp</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">match</span>)
225:               )
226:             )
227:           )
228:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">-1</span>]}
229:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002651">
                    
                    <a name="M002651"></a><b>get_namespace</b>( prefix )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002651_source')" id="l_M002651_source">show</a>
                        
                    </p>
                    <div id="M002651_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 240</span>
240:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_namespace</span>( <span class="ruby-identifier">prefix</span> )
241:         <span class="ruby-identifier">uris</span> = (<span class="ruby-ivar">@namespace_stack</span>.<span class="ruby-identifier">find_all</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ns</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">ns</span>[<span class="ruby-identifier">prefix</span>].<span class="ruby-identifier">nil?</span> }) <span class="ruby-operator">||</span>
242:           (<span class="ruby-ivar">@namespace_stack</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ns</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">ns</span>[<span class="ruby-keyword kw">nil</span>].<span class="ruby-identifier">nil?</span> })
243:         <span class="ruby-identifier">uris</span>[<span class="ruby-value">-1</span>][<span class="ruby-identifier">prefix</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">uris</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">uris</span>.<span class="ruby-identifier">size</span>
244:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002648">
                    
                    <a name="M002648"></a><b>get_procs</b>( symbol, name )
                    
                </div>
                
                <div class="description">
                  <p>
The following methods are duplicates, but it is faster than using a helper
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002648_source')" id="l_M002648_source">show</a>
                        
                    </p>
                    <div id="M002648_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 203</span>
203:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_procs</span>( <span class="ruby-identifier">symbol</span>, <span class="ruby-identifier">name</span> )
204:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@procs</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
205:         <span class="ruby-ivar">@procs</span>.<span class="ruby-identifier">find_all</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>, <span class="ruby-identifier">match</span>, <span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
206:           <span class="ruby-comment cmt">#puts sym.inspect+&quot;==&quot;+symbol.inspect+ &quot;\t&quot;+match.inspect+&quot;==&quot;+name.inspect+ &quot;\t&quot;+( (sym.nil? or symbol == sym) and ((name.nil? and match.nil?) or match.nil? or ( (name == match) or (match.kind_of? Regexp and name =~ match)))).to_s</span>
207:           (
208:             (<span class="ruby-identifier">sym</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">symbol</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">sym</span>) <span class="ruby-keyword kw">and</span>
209:             ((<span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> (
210:               (<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">match</span>) <span class="ruby-keyword kw">or</span>
211:               (<span class="ruby-identifier">match</span>.<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">Regexp</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">match</span>)
212:               )
213:             )
214:           )
215:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">-1</span>]}
216:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M002647">
                    
                    <a name="M002647"></a><b>handle</b>( symbol, *arguments )
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M002647_source')" id="l_M002647_source">show</a>
                        
                    </p>
                    <div id="M002647_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rexml/parsers/sax2parser.rb, line 190</span>
190:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle</span>( <span class="ruby-identifier">symbol</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">arguments</span> )
191:         <span class="ruby-identifier">tag</span> = <span class="ruby-ivar">@tag_stack</span>[<span class="ruby-value">-1</span>]
192:         <span class="ruby-identifier">procs</span> = <span class="ruby-identifier">get_procs</span>( <span class="ruby-identifier">symbol</span>, <span class="ruby-identifier">tag</span> )
193:         <span class="ruby-identifier">listeners</span> = <span class="ruby-identifier">get_listeners</span>( <span class="ruby-identifier">symbol</span>, <span class="ruby-identifier">tag</span> )
194:         <span class="ruby-comment cmt"># notify observers</span>
195:         <span class="ruby-identifier">procs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ob</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">call</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">arguments</span> ) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procs</span>
196:         <span class="ruby-identifier">listeners</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
197:           <span class="ruby-identifier">l</span>.<span class="ruby-identifier">send</span>( <span class="ruby-identifier">symbol</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">arguments</span> )
198:         } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">listeners</span>
199:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    