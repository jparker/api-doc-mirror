<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Gem::SourceInfoCache</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Gem::SourceInfoCache 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/rubygems/source_info_cache_rb.html">lib/rubygems/source_info_cache.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="SourceInfoCache.html">SourceInfoCache</a> stores a copy of the gem
index for each gem source.
</p>
<p>
There are two possible cache locations, the system cache and the user
cache:
</p>
<ul>
<li>The system cache is preferred if it is writable or can be created.

</li>
<li>The user cache is used otherwise

</li>
</ul>
<p>
Once a cache is selected, it will be used for all operations. <a
href="SourceInfoCache.html">SourceInfoCache</a> will not switch between
cache files dynamically.
</p>
<p>
Cache data is a <a href="../Hash.html">Hash</a> mapping a source <a
href="../URI.html">URI</a> to a <a
href="SourceInfoCacheEntry.html">SourceInfoCacheEntry</a>.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M005518">cache</a>,</li>
                
                <li><a href="#M005519">cache_data</a>,</li>
                
                <li><a href="#M005528">cache_data</a>,</li>
                
                <li><a href="#M005529">cache_file</a></li>
                
            </ul>
        </dd>
    
        <dt>F</dt>
        <dd>
            <ul>
                
                <li><a href="#M005530">flush</a></li>
                
            </ul>
        </dd>
    
        <dt>L</dt>
        <dd>
            <ul>
                
                <li><a href="#M005531">latest_cache_data</a>,</li>
                
                <li><a href="#M005532">latest_cache_file</a>,</li>
                
                <li><a href="#M005520">latest_system_cache_file</a>,</li>
                
                <li><a href="#M005533">latest_system_cache_file</a>,</li>
                
                <li><a href="#M005521">latest_user_cache_file</a>,</li>
                
                <li><a href="#M005537">latest_user_cache_file</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M005538">read_all_cache_data</a>,</li>
                
                <li><a href="#M005539">read_cache_data</a>,</li>
                
                <li><a href="#M005540">refresh</a>,</li>
                
                <li><a href="#M005522">reset</a>,</li>
                
                <li><a href="#M005542">reset_cache_data</a>,</li>
                
                <li><a href="#M005543">reset_cache_file</a>,</li>
                
                <li><a href="#M005541">reset_cache_for</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M005523">search</a>,</li>
                
                <li><a href="#M005544">search</a>,</li>
                
                <li><a href="#M005545">search_with_source</a>,</li>
                
                <li><a href="#M005524">search_with_source</a>,</li>
                
                <li><a href="#M005546">set_cache_data</a>,</li>
                
                <li><a href="#M005547">system_cache_file</a>,</li>
                
                <li><a href="#M005525">system_cache_file</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M005548">try_file</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M005549">update</a>,</li>
                
                <li><a href="#M005526">user_cache_file</a>,</li>
                
                <li><a href="#M005550">user_cache_file</a></li>
                
            </ul>
        </dd>
    
        <dt>W</dt>
        <dd>
            <ul>
                
                <li><a href="#M005551">write_cache</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    
    <div class="sectiontitle">Included Modules</div>
    <ul>
        
        <li>
            
            <a href="../Kernel.html">Kernel</a>
            
            START:includes
        </li>
        
    </ul>
    

    

    

    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M005518">
                    
                    <a name="M005518"></a><b>cache</b>(all = false)
                    
                </div>
                
                <div class="description">
                  <p>
The singleton <a href="SourceInfoCache.html">Gem::SourceInfoCache</a>. If
<tt>all</tt> is true, a full refresh will be performed if the singleton
instance is being initialized.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005518_source')" id="l_M005518_source">show</a>
                        
                    </p>
                    <div id="M005518_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 38</span>
38:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cache</span>(<span class="ruby-identifier">all</span> = <span class="ruby-keyword kw">false</span>)
39:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@cache</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@cache</span>
40:     <span class="ruby-ivar">@cache</span> = <span class="ruby-identifier">new</span>
41:     <span class="ruby-ivar">@cache</span>.<span class="ruby-identifier">refresh</span> <span class="ruby-identifier">all</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">update_sources</span>
42:     <span class="ruby-ivar">@cache</span>
43:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005519">
                    
                    <a name="M005519"></a><b>cache_data</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005519_source')" id="l_M005519_source">show</a>
                        
                    </p>
                    <div id="M005519_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 45</span>
45:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cache_data</span>
46:     <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">cache_data</span>
47:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005520">
                    
                    <a name="M005520"></a><b>latest_system_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the system cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005520_source')" id="l_M005520_source">show</a>
                        
                    </p>
                    <div id="M005520_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 52</span>
52:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">latest_system_cache_file</span>
53:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">system_cache_file</span>),
54:               <span class="ruby-node">&quot;latest_#{File.basename system_cache_file}&quot;</span>
55:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005521">
                    
                    <a name="M005521"></a><b>latest_user_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the latest user cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005521_source')" id="l_M005521_source">show</a>
                        
                    </p>
                    <div id="M005521_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 60</span>
60:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">latest_user_cache_file</span>
61:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">user_cache_file</span>),
62:               <span class="ruby-node">&quot;latest_#{File.basename user_cache_file}&quot;</span>
63:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005522">
                    
                    <a name="M005522"></a><b>reset</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Reset all singletons, discarding any changes.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005522_source')" id="l_M005522_source">show</a>
                        
                    </p>
                    <div id="M005522_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 68</span>
68:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reset</span>
69:     <span class="ruby-ivar">@cache</span> = <span class="ruby-keyword kw">nil</span>
70:     <span class="ruby-ivar">@system_cache_file</span> = <span class="ruby-keyword kw">nil</span>
71:     <span class="ruby-ivar">@user_cache_file</span> = <span class="ruby-keyword kw">nil</span>
72:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005523">
                    
                    <a name="M005523"></a><b>search</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Search all source indexes. See <a
href="SourceInfoCache.html#M005523">Gem::SourceInfoCache#search</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005523_source')" id="l_M005523_source">show</a>
                        
                    </p>
                    <div id="M005523_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 77</span>
77:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
78:     <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">search</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
79:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005524">
                    
                    <a name="M005524"></a><b>search_with_source</b>(*args)
                    
                </div>
                
                <div class="description">
                  <p>
Search all source indexes returning the source_uri. See <a
href="SourceInfoCache.html#M005524">Gem::SourceInfoCache#search_with_source</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005524_source')" id="l_M005524_source">show</a>
                        
                    </p>
                    <div id="M005524_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 85</span>
85:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">search_with_source</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
86:     <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">search_with_source</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
87:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005525">
                    
                    <a name="M005525"></a><b>system_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the system cache file. (class method)
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005525_source')" id="l_M005525_source">show</a>
                        
                    </p>
                    <div id="M005525_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 92</span>
92:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">system_cache_file</span>
93:     <span class="ruby-ivar">@system_cache_file</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">default_system_source_cache_dir</span>
94:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005526">
                    
                    <a name="M005526"></a><b>user_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the user cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005526_source')" id="l_M005526_source">show</a>
                        
                    </p>
                    <div id="M005526_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 99</span>
 99:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_cache_file</span>
100:     <span class="ruby-ivar">@user_cache_file</span> <span class="ruby-operator">||=</span>
101:       <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEMCACHE'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">default_user_source_cache_dir</span>
102:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M005528">
                    
                    <a name="M005528"></a><b>cache_data</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The most recent cache data.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005528_source')" id="l_M005528_source">show</a>
                        
                    </p>
                    <div id="M005528_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 114</span>
114:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_data</span>
115:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@cache_data</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@cache_data</span>
116:     <span class="ruby-identifier">cache_file</span> <span class="ruby-comment cmt"># HACK writable check</span>
117: 
118:     <span class="ruby-ivar">@only_latest</span> = <span class="ruby-keyword kw">true</span>
119: 
120:     <span class="ruby-ivar">@cache_data</span> = <span class="ruby-identifier">read_cache_data</span> <span class="ruby-identifier">latest_cache_file</span>
121: 
122:     <span class="ruby-ivar">@cache_data</span>
123:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005529">
                    
                    <a name="M005529"></a><b>cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005529_source')" id="l_M005529_source">show</a>
                        
                    </p>
                    <div id="M005529_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 128</span>
128:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cache_file</span>
129:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@cache_file</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@cache_file</span>
130:     <span class="ruby-ivar">@cache_file</span> = (<span class="ruby-identifier">try_file</span>(<span class="ruby-identifier">system_cache_file</span>) <span class="ruby-keyword kw">or</span>
131:       <span class="ruby-identifier">try_file</span>(<span class="ruby-identifier">user_cache_file</span>) <span class="ruby-keyword kw">or</span>
132:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;unable to locate a writable cache file&quot;</span>)
133:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005530">
                    
                    <a name="M005530"></a><b>flush</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Write the cache to a local file (if it is dirty).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005530_source')" id="l_M005530_source">show</a>
                        
                    </p>
                    <div id="M005530_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 138</span>
138:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flush</span>
139:     <span class="ruby-identifier">write_cache</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@dirty</span>
140:     <span class="ruby-ivar">@dirty</span> = <span class="ruby-keyword kw">false</span>
141:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005531">
                    
                    <a name="M005531"></a><b>latest_cache_data</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005531_source')" id="l_M005531_source">show</a>
                        
                    </p>
                    <div id="M005531_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 143</span>
143:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">latest_cache_data</span>
144:     <span class="ruby-identifier">latest_cache_data</span> = {}
145: 
146:     <span class="ruby-identifier">cache_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">repo</span>, <span class="ruby-identifier">sice</span><span class="ruby-operator">|</span>
147:       <span class="ruby-identifier">latest</span> = <span class="ruby-identifier">sice</span>.<span class="ruby-identifier">source_index</span>.<span class="ruby-identifier">latest_specs</span>
148: 
149:       <span class="ruby-identifier">new_si</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceIndex</span>.<span class="ruby-identifier">new</span>
150:       <span class="ruby-identifier">new_si</span>.<span class="ruby-identifier">add_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">latest</span>)
151: 
152:       <span class="ruby-identifier">latest_sice</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceInfoCacheEntry</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">new_si</span>, <span class="ruby-identifier">sice</span>.<span class="ruby-identifier">size</span>
153:       <span class="ruby-identifier">latest_cache_data</span>[<span class="ruby-identifier">repo</span>] = <span class="ruby-identifier">latest_sice</span>
154:     <span class="ruby-keyword kw">end</span>
155: 
156:     <span class="ruby-identifier">latest_cache_data</span>
157:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005532">
                    
                    <a name="M005532"></a><b>latest_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the latest cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005532_source')" id="l_M005532_source">show</a>
                        
                    </p>
                    <div id="M005532_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 162</span>
162:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">latest_cache_file</span>
163:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">cache_file</span>), <span class="ruby-node">&quot;latest_#{File.basename cache_file}&quot;</span>
164:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005533">
                    
                    <a name="M005533"></a><b>latest_system_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the latest system cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005533_source')" id="l_M005533_source">show</a>
                        
                    </p>
                    <div id="M005533_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 169</span>
169:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">latest_system_cache_file</span>
170:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">latest_system_cache_file</span>
171:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005537">
                    
                    <a name="M005537"></a><b>latest_user_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the latest user cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005537_source')" id="l_M005537_source">show</a>
                        
                    </p>
                    <div id="M005537_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 176</span>
176:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">latest_user_cache_file</span>
177:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">latest_user_cache_file</span>
178:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005538">
                    
                    <a name="M005538"></a><b>read_all_cache_data</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Merges the complete cache file into this <a
href="SourceInfoCache.html">Gem::SourceInfoCache</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005538_source')" id="l_M005538_source">show</a>
                        
                    </p>
                    <div id="M005538_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 183</span>
183:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_all_cache_data</span>
184:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@only_latest</span> <span class="ruby-keyword kw">then</span>
185:       <span class="ruby-ivar">@only_latest</span> = <span class="ruby-keyword kw">false</span>
186:       <span class="ruby-identifier">all_data</span> = <span class="ruby-identifier">read_cache_data</span> <span class="ruby-identifier">cache_file</span>
187: 
188:       <span class="ruby-identifier">cache_data</span>.<span class="ruby-identifier">update</span> <span class="ruby-identifier">all_data</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">source_uri</span>, <span class="ruby-identifier">latest_sice</span>, <span class="ruby-identifier">all_sice</span><span class="ruby-operator">|</span>
189:         <span class="ruby-identifier">all_sice</span>.<span class="ruby-identifier">source_index</span>.<span class="ruby-identifier">gems</span>.<span class="ruby-identifier">update</span> <span class="ruby-identifier">latest_sice</span>.<span class="ruby-identifier">source_index</span>.<span class="ruby-identifier">gems</span>
190: 
191:         <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceInfoCacheEntry</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">all_sice</span>.<span class="ruby-identifier">source_index</span>, <span class="ruby-identifier">latest_sice</span>.<span class="ruby-identifier">size</span>
192:       <span class="ruby-keyword kw">end</span>
193: 
194:       <span class="ruby-keyword kw">begin</span>
195:         <span class="ruby-identifier">refresh</span> <span class="ruby-keyword kw">true</span>
196:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span><span class="ruby-operator">::</span><span class="ruby-constant">FetchError</span>
197:       <span class="ruby-keyword kw">end</span>
198:     <span class="ruby-keyword kw">end</span>
199:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005539">
                    
                    <a name="M005539"></a><b>read_cache_data</b>(file)
                    
                </div>
                
                <div class="description">
                  <p>
Reads cached data from <tt>file</tt>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005539_source')" id="l_M005539_source">show</a>
                        
                    </p>
                    <div id="M005539_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 204</span>
204:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_cache_data</span>(<span class="ruby-identifier">file</span>)
205:     <span class="ruby-comment cmt"># Marshal loads 30-40% faster from a String, and 2MB on 20061116 is small</span>
206:     <span class="ruby-identifier">data</span> = <span class="ruby-identifier">open</span> <span class="ruby-identifier">file</span>, <span class="ruby-value str">'rb'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fp</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fp</span>.<span class="ruby-identifier">read</span> <span class="ruby-keyword kw">end</span>
207:     <span class="ruby-identifier">cache_data</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-identifier">data</span>
208: 
209:     <span class="ruby-identifier">cache_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">url</span>, <span class="ruby-identifier">sice</span><span class="ruby-operator">|</span>
210:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sice</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
211:       <span class="ruby-identifier">update</span>
212: 
213:       <span class="ruby-identifier">cache</span> = <span class="ruby-identifier">sice</span>[<span class="ruby-value str">'cache'</span>]
214:       <span class="ruby-identifier">size</span>  = <span class="ruby-identifier">sice</span>[<span class="ruby-value str">'size'</span>]
215: 
216:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cache</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceIndex</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">size</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Numeric</span>) <span class="ruby-keyword kw">then</span>
217:         <span class="ruby-identifier">new_sice</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceInfoCacheEntry</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">cache</span>, <span class="ruby-identifier">size</span>
218:         <span class="ruby-identifier">cache_data</span>[<span class="ruby-identifier">url</span>] = <span class="ruby-identifier">new_sice</span>
219:       <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># irreperable, force refetch.</span>
220:         <span class="ruby-identifier">reset_cache_for</span> <span class="ruby-identifier">url</span>, <span class="ruby-identifier">cache_data</span>
221:       <span class="ruby-keyword kw">end</span>
222:     <span class="ruby-keyword kw">end</span>
223: 
224:     <span class="ruby-identifier">cache_data</span>
225:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
226:     {}
227:   <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
228:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">really_verbose</span> <span class="ruby-keyword kw">then</span>
229:       <span class="ruby-identifier">say</span> <span class="ruby-node">&quot;Exception during cache_data handling: #{e.class} - #{e}&quot;</span>
230:       <span class="ruby-identifier">say</span> <span class="ruby-node">&quot;Cache file was: #{file}&quot;</span>
231:       <span class="ruby-identifier">say</span> <span class="ruby-node">&quot;\t#{e.backtrace.join &quot;\n\t&quot;}&quot;</span>
232:     <span class="ruby-keyword kw">end</span>
233: 
234:     {}
235:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005540">
                    
                    <a name="M005540"></a><b>refresh</b>(all)
                    
                </div>
                
                <div class="description">
                  <p>
Refreshes each source in the cache from its repository. If <tt>all</tt> is
false, only latest gems are updated.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005540_source')" id="l_M005540_source">show</a>
                        
                    </p>
                    <div id="M005540_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 241</span>
241:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refresh</span>(<span class="ruby-identifier">all</span>)
242:     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">sources</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">source_uri</span><span class="ruby-operator">|</span>
243:       <span class="ruby-identifier">cache_entry</span> = <span class="ruby-identifier">cache_data</span>[<span class="ruby-identifier">source_uri</span>]
244:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cache_entry</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span>
245:         <span class="ruby-identifier">cache_entry</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceInfoCacheEntry</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>
246:         <span class="ruby-identifier">cache_data</span>[<span class="ruby-identifier">source_uri</span>] = <span class="ruby-identifier">cache_entry</span>
247:       <span class="ruby-keyword kw">end</span>
248: 
249:       <span class="ruby-identifier">update</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cache_entry</span>.<span class="ruby-identifier">refresh</span> <span class="ruby-identifier">source_uri</span>, <span class="ruby-identifier">all</span>
250:     <span class="ruby-keyword kw">end</span>
251: 
252:     <span class="ruby-identifier">flush</span>
253:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005542">
                    
                    <a name="M005542"></a><b>reset_cache_data</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005542_source')" id="l_M005542_source">show</a>
                        
                    </p>
                    <div id="M005542_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 265</span>
265:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_cache_data</span>
266:     <span class="ruby-ivar">@cache_data</span> = <span class="ruby-keyword kw">nil</span>
267:     <span class="ruby-ivar">@only_latest</span> = <span class="ruby-keyword kw">true</span>
268:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005543">
                    
                    <a name="M005543"></a><b>reset_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Force cache file to be reset, useful for integration testing of rubygems
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005543_source')" id="l_M005543_source">show</a>
                        
                    </p>
                    <div id="M005543_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 273</span>
273:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_cache_file</span>
274:     <span class="ruby-ivar">@cache_file</span> = <span class="ruby-keyword kw">nil</span>
275:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005541">
                    
                    <a name="M005541"></a><b>reset_cache_for</b>(url, cache_data)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005541_source')" id="l_M005541_source">show</a>
                        
                    </p>
                    <div id="M005541_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 255</span>
255:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_cache_for</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">cache_data</span>)
256:     <span class="ruby-identifier">say</span> <span class="ruby-node">&quot;Reseting cache for #{url}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">really_verbose</span>
257: 
258:     <span class="ruby-identifier">sice</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceInfoCacheEntry</span>.<span class="ruby-identifier">new</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SourceIndex</span>.<span class="ruby-identifier">new</span>, <span class="ruby-value">0</span>
259:     <span class="ruby-identifier">sice</span>.<span class="ruby-identifier">refresh</span> <span class="ruby-identifier">url</span>, <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># HACK may be unnecessary, see ::cache and #refresh</span>
260: 
261:     <span class="ruby-identifier">cache_data</span>[<span class="ruby-identifier">url</span>] = <span class="ruby-identifier">sice</span>
262:     <span class="ruby-identifier">cache_data</span>
263:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005544">
                    
                    <a name="M005544"></a><b>search</b>(pattern, platform_only = false, all = false)
                    
                </div>
                
                <div class="description">
                  <p>
Searches all source indexes. See <a
href="SourceIndex.html#M005857">Gem::SourceIndex#search</a> for details on
<tt>pattern</tt> and <tt>platform_only</tt>. If <tt>all</tt> is set to
true, the full index will be loaded before searching.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005544_source')" id="l_M005544_source">show</a>
                        
                    </p>
                    <div id="M005544_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 282</span>
282:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">platform_only</span> = <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">all</span> = <span class="ruby-keyword kw">false</span>)
283:     <span class="ruby-identifier">read_all_cache_data</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">all</span>
284: 
285:     <span class="ruby-identifier">cache_data</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">source_uri</span>, <span class="ruby-identifier">sic_entry</span><span class="ruby-operator">|</span>
286:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">sources</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">source_uri</span>
287:       <span class="ruby-comment cmt"># TODO - Remove this gunk after 2008/11</span>
288:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependency</span> <span class="ruby-keyword kw">then</span>
289:         <span class="ruby-identifier">pattern</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependency</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">pattern</span>, <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Requirement</span>.<span class="ruby-identifier">default</span>
290:       <span class="ruby-keyword kw">end</span>
291:       <span class="ruby-identifier">sic_entry</span>.<span class="ruby-identifier">source_index</span>.<span class="ruby-identifier">search</span> <span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">platform_only</span>
292:     <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
293:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005545">
                    
                    <a name="M005545"></a><b>search_with_source</b>(pattern, only_platform = false, all = false)
                    
                </div>
                
                <div class="description">
                  <p>
Searches all source indexes for <tt>pattern</tt>. If <tt>only_platform</tt>
is true, only gems matching <a href="../Gem.html#M004613">Gem.platforms</a>
will be selected. Returns an <a href="../Array.html">Array</a> of pairs
containing the <a href="Specification.html">Gem::Specification</a> found
and the source_uri it was found at.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005545_source')" id="l_M005545_source">show</a>
                        
                    </p>
                    <div id="M005545_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 301</span>
301:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search_with_source</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">only_platform</span> = <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">all</span> = <span class="ruby-keyword kw">false</span>)
302:     <span class="ruby-identifier">read_all_cache_data</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">all</span>
303: 
304:     <span class="ruby-identifier">results</span> = []
305: 
306:     <span class="ruby-identifier">cache_data</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">source_uri</span>, <span class="ruby-identifier">sic_entry</span><span class="ruby-operator">|</span>
307:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">sources</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">source_uri</span>
308: 
309:       <span class="ruby-comment cmt"># TODO - Remove this gunk after 2008/11</span>
310:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependency</span>)
311:         <span class="ruby-identifier">pattern</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependency</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Requirement</span>.<span class="ruby-identifier">default</span>) 
312:       <span class="ruby-keyword kw">end</span>
313: 
314:       <span class="ruby-identifier">sic_entry</span>.<span class="ruby-identifier">source_index</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">only_platform</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
315:         <span class="ruby-identifier">results</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">source_uri</span>]
316:       <span class="ruby-keyword kw">end</span>
317:     <span class="ruby-keyword kw">end</span>
318: 
319:     <span class="ruby-identifier">results</span>
320:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005546">
                    
                    <a name="M005546"></a><b>set_cache_data</b>(hash)
                    
                </div>
                
                <div class="description">
                  <p>
<a href="../Set.html">Set</a> the source info cache data directly. This is
mainly used for unit testing when we don&#8217;t want to read a file system
to grab the cached source index information. The <tt>hash</tt> should map a
source URL into a <a
href="SourceInfoCacheEntry.html">SourceInfoCacheEntry</a>.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005546_source')" id="l_M005546_source">show</a>
                        
                    </p>
                    <div id="M005546_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 328</span>
328:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_cache_data</span>(<span class="ruby-identifier">hash</span>)
329:     <span class="ruby-ivar">@cache_data</span> = <span class="ruby-identifier">hash</span>
330:     <span class="ruby-identifier">update</span>
331:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005547">
                    
                    <a name="M005547"></a><b>system_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the system cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005547_source')" id="l_M005547_source">show</a>
                        
                    </p>
                    <div id="M005547_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 336</span>
336:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">system_cache_file</span>
337:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">system_cache_file</span>
338:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005548">
                    
                    <a name="M005548"></a><b>try_file</b>(path)
                    
                </div>
                
                <div class="description">
                  <p>
Determine if <tt>path</tt> is a candidate for a cache file. Returns
<tt>path</tt> if it is, nil if not.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005548_source')" id="l_M005548_source">show</a>
                        
                    </p>
                    <div id="M005548_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 344</span>
344:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">try_file</span>(<span class="ruby-identifier">path</span>)
345:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">writable?</span> <span class="ruby-identifier">path</span>
346:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">path</span>
347: 
348:     <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">path</span>
349: 
350:     <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword kw">then</span>
351:       <span class="ruby-keyword kw">begin</span>
352:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span>
353:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">RuntimeError</span>, <span class="ruby-constant">SystemCallError</span>
354:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
355:       <span class="ruby-keyword kw">end</span>
356:     <span class="ruby-keyword kw">end</span>
357: 
358:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">writable?</span> <span class="ruby-identifier">dir</span>
359: 
360:     <span class="ruby-keyword kw">nil</span>
361:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005549">
                    
                    <a name="M005549"></a><b>update</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Mark the cache as updated (i.e. dirty).
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005549_source')" id="l_M005549_source">show</a>
                        
                    </p>
                    <div id="M005549_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 366</span>
366:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
367:     <span class="ruby-ivar">@dirty</span> = <span class="ruby-keyword kw">true</span>
368:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005550">
                    
                    <a name="M005550"></a><b>user_cache_file</b>()
                    
                </div>
                
                <div class="description">
                  <p>
The name of the user cache file.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005550_source')" id="l_M005550_source">show</a>
                        
                    </p>
                    <div id="M005550_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">user_cache_file</span>
374:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">user_cache_file</span>
375:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M005551">
                    
                    <a name="M005551"></a><b>write_cache</b>()
                    
                </div>
                
                <div class="description">
                  <p>
Write data to the proper cache files.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M005551_source')" id="l_M005551_source">show</a>
                        
                    </p>
                    <div id="M005551_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File lib/rubygems/source_info_cache.rb, line 380</span>
380:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_cache</span>
381:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">cache_file</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-ivar">@only_latest</span> <span class="ruby-keyword kw">then</span>
382:       <span class="ruby-identifier">open</span> <span class="ruby-identifier">cache_file</span>, <span class="ruby-value str">'wb'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
383:         <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">cache_data</span>)
384:       <span class="ruby-keyword kw">end</span>
385:     <span class="ruby-keyword kw">end</span>
386: 
387:     <span class="ruby-identifier">open</span> <span class="ruby-identifier">latest_cache_file</span>, <span class="ruby-value str">'wb'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
388:       <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">latest_cache_data</span>)
389:     <span class="ruby-keyword kw">end</span>
390:   <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    