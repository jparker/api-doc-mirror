<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>NKF</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            NKF 
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/ext/nkf/nkf_c.html">ext/nkf/nkf.c</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
<a href="NKF.html">NKF</a> - Ruby extension for Network Kanji Filter
</p>
<h2>Description</h2>
<p>
This is a Ruby Extension version of nkf (Network Kanji Filter). It converts
the first argument and returns converted result. Conversion details are
specified by flags as the first argument.
</p>
<p>
<b>Nkf</b> is a yet another kanji code converter among networks, hosts and
terminals. It converts input kanji code to designated kanji code such as
ISO-2022-JP, Shift_JIS, EUC-JP, UTF-8 or UTF-16.
</p>
<p>
One of the most unique faculty of <b>nkf</b> is the guess of the input
kanji encodings. It currently recognizes ISO-2022-JP, Shift_JIS, EUC-JP,
UTF-8 and UTF-16. So users needn&#8217;t set the input kanji code
explicitly.
</p>
<p>
By default, X0201 kana is converted into X0208 kana. For X0201 kana, SO/SI,
SSO and ESC-(-I methods are supported. For automatic code detection, nkf
assumes no X0201 kana in Shift_JIS. To accept X0201 in Shift_JIS, use
<b>-X</b>, <b>-x</b> or <b>-S</b>.
</p>
<h2>Flags</h2>
<h3>-b -u</h3>
<p>
Output is buffered (DEFAULT), Output is unbuffered.
</p>
<h3>-j -s -e -w -w16 -w32</h3>
<p>
Output code is ISO-2022-JP (7bit <a href="NKF.html#JIS">JIS</a>),
Shift_JIS, EUC-JP, UTF-8N, UTF-16BE, UTF-32BE. Without this option and
compile option, ISO-2022-JP is assumed.
</p>
<h3>-J -S -E -W -W16 -W32</h3>
<p>
Input assumption is <a href="NKF.html#JIS">JIS</a> 7 bit, Shift_JIS,
EUC-JP, UTF-8, UTF-16, UTF-32.
</p>
<h4>-J</h4>
<p>
Assume <a href="NKF.html#JIS">JIS</a> input. It also accepts EUC-JP. This
is the default. This flag does not exclude Shift_JIS.
</p>
<h4>-S</h4>
<p>
Assume Shift_JIS and X0201 kana input. It also accepts <a
href="NKF.html#JIS">JIS</a>. EUC-JP is recognized as X0201 kana. Without
<b>-x</b> flag, X0201 kana (halfwidth kana) is converted into X0208.
</p>
<h4>-E</h4>
<p>
Assume EUC-JP input. It also accepts <a href="NKF.html#JIS">JIS</a>. Same
as -J.
</p>
<h3>-t</h3>
<p>
No conversion.
</p>
<h3>-i_</h3>
<p>
Output sequence to designate JIS-kanji. (DEFAULT B)
</p>
<h3>-o_</h3>
<p>
Output sequence to designate <a href="NKF.html#ASCII">ASCII</a>. (DEFAULT
B)
</p>
<h3>-r</h3>
<p>
{de/en}crypt ROT13/47
</p>
<h3>-h[123] &#8212;hiragana &#8212;katakana &#8212;katakana-hiragana</h3>
<dl>
<dt>-h1 &#8212;hiragana</dt><dd>Katakana to Hiragana conversion.

</dd>
<dt>-h2 &#8212;katakana</dt><dd>Hiragana to Katakana conversion.

</dd>
<dt>-h3 &#8212;katakana-hiragana</dt><dd>Katakana to Hiragana and Hiragana to Katakana conversion.

</dd>
</dl>
<h3>-T</h3>
<p>
Text mode output (MS-DOS)
</p>
<h3>-l</h3>
<p>
ISO8859-1 (Latin-1) support
</p>
<h3>-f[<tt>m</tt> [- <tt>n</tt>]]</h3>
<p>
Folding on <tt>m</tt> length with <tt>n</tt> margin in a line. Without this
option, fold length is 60 and fold margin is 10.
</p>
<h3>-F</h3>
<p>
New line preserving line folding.
</p>
<h3>-Z[0-3]</h3>
<p>
Convert X0208 alphabet (Fullwidth Alphabets) to <a
href="NKF.html#ASCII">ASCII</a>.
</p>
<dl>
<dt>-Z -Z0</dt><dd>Convert X0208 alphabet to <a href="NKF.html#ASCII">ASCII</a>.

</dd>
<dt>-Z1</dt><dd>Converts X0208 kankaku to single <a href="NKF.html#ASCII">ASCII</a> space.

</dd>
<dt>-Z2</dt><dd>Converts X0208 kankaku to double <a href="NKF.html#ASCII">ASCII</a> spaces.

</dd>
<dt>-Z3</dt><dd>Replacing Fullwidth >, <, &#8220;, &amp; into &#8217;&amp;gt;&#8217;,
&#8217;&amp;lt;&#8217;, &#8217;&amp;quot;&#8217;, &#8217;&amp;amp;&#8217;
as in HTML.

</dd>
</dl>
<h3>-X -x</h3>
<p>
Assume X0201 kana in MS-Kanji. With <b>-X</b> or without this option, X0201
is converted into X0208 Kana. With <b>-x</b>, try to preserve X0208 kana
and do not convert X0201 kana to X0208. In <a href="NKF.html#JIS">JIS</a>
output, ESC-(-I is used. In <a href="NKF.html#EUC">EUC</a> output, SSO is
used.
</p>
<h3>-B[0-2]</h3>
<p>
Assume broken JIS-Kanji input, which lost ESC. Useful when your site is
using old B-News Nihongo patch.
</p>
<dl>
<dt>-B1</dt><dd>allows any char after ESC-( or ESC-$.

</dd>
<dt>-B2</dt><dd>forces <a href="NKF.html#ASCII">ASCII</a> after NL.

</dd>
</dl>
<h3>-I</h3>
<p>
Replacing non iso-2022-jp char into a geta character (substitute character
in Japanese).
</p>
<h3>-d -c</h3>
<p>
Delete r in line feed, Add r in line feed.
</p>
<h3>-m[BQN0]</h3>
<p>
MIME ISO-2022-JP/ISO8859-1 decode. (DEFAULT) To see ISO8859-1 (Latin-1) -l
is necessary.
</p>
<dl>
<dt>-mB</dt><dd>Decode MIME base64 encoded stream. Remove header or other part before

</dd>
</dl>
<p>
conversion.
</p>
<dl>
<dt>-mQ</dt><dd>Decode MIME quoted stream. &#8216;_&#8217; in quoted stream is converted to
space.

</dd>
<dt>-mN</dt><dd>Non-strict decoding.

</dd>
</dl>
<p>
It allows line break in the middle of the base64 encoding.
</p>
<dl>
<dt>-m0</dt><dd>No MIME decode.

</dd>
</dl>
<h3>-M</h3>
<p>
MIME encode. Header style. All <a href="NKF.html#ASCII">ASCII</a> code and
control characters are intact. Kanji conversion is performed before
encoding, so this cannot be used as a picture encoder.
</p>
<dl>
<dt>-MB</dt><dd>MIME encode <a href="Base64.html">Base64</a> stream.

</dd>
<dt>-MQ</dt><dd>Perfome quoted encoding.

</dd>
</dl>
<h3>-l</h3>
<p>
Input and output code is ISO8859-1 (Latin-1) and ISO-2022-JP. <b>-s</b>,
<b>-e</b> and <b>-x</b> are not compatible with this option.
</p>
<h3>-L[uwm]</h3>
<p>
new line mode Without this option, nkf doesn&#8217;t convert line breaks.
</p>
<dl>
<dt>-Lu</dt><dd>unix (LF)

</dd>
<dt>-Lw</dt><dd>windows (CRLF)

</dd>
<dt>-Lm</dt><dd>mac (CR)

</dd>
</dl>
<h3>&#8212;fj &#8212;unix &#8212;mac &#8212;msdos &#8212;windows</h3>
<p>
convert for these system
</p>
<h3>&#8212;jis &#8212;euc &#8212;sjis &#8212;mime &#8212;base64</h3>
<p>
convert for named code
</p>
<h3>&#8212;jis-input &#8212;euc-input &#8212;sjis-input &#8212;mime-input &#8212;base64-input</h3>
<p>
assume input system
</p>
<h3>&#8212;ic=<tt>input codeset</tt> &#8212;oc=<tt>output codeset</tt></h3>
<p>
<a href="Set.html">Set</a> the input or output codeset. <a
href="NKF.html">NKF</a> supports following codesets and those codeset name
are case insensitive.
</p>
<dl>
<dt>ISO-2022-JP</dt><dd>a.k.a. RFC1468, 7bit <a href="NKF.html#JIS">JIS</a>, JUNET

</dd>
<dt>EUC-JP (eucJP-nkf)</dt><dd>a.k.a. AT&amp;T <a href="NKF.html#JIS">JIS</a>, Japanese <a
href="NKF.html#EUC">EUC</a>, UJIS

</dd>
<dt>eucJP-ascii</dt><dd>a.k.a. x-eucjp-open-19970715-ascii

</dd>
<dt>eucJP-ms</dt><dd>a.k.a. x-eucjp-open-19970715-ms

</dd>
<dt>CP51932</dt><dd>Microsoft Version of EUC-JP.

</dd>
<dt>Shift_JIS</dt><dd><a href="NKF.html#SJIS">SJIS</a>, MS-Kanji

</dd>
<dt>Windows-31J</dt><dd>a.k.a. CP932

</dd>
<dt>UTF-8</dt><dd>same as UTF-8N

</dd>
<dt>UTF-8N</dt><dd>UTF-8 without BOM

</dd>
<dt>UTF-8-BOM</dt><dd>UTF-8 with BOM

</dd>
<dt>UTF-16</dt><dd>same as UTF-16BE

</dd>
<dt>UTF-16BE</dt><dd>UTF-16 Big Endian without BOM

</dd>
<dt>UTF-16BE-BOM</dt><dd>UTF-16 Big Endian with BOM

</dd>
<dt>UTF-16LE</dt><dd>UTF-16 Little Endian without BOM

</dd>
<dt>UTF-16LE-BOM</dt><dd>UTF-16 Little Endian with BOM

</dd>
<dt>UTF-32</dt><dd>same as UTF-32BE

</dd>
<dt>UTF-32BE</dt><dd>UTF-32 Big Endian without BOM

</dd>
<dt>UTF-32BE-BOM</dt><dd>UTF-32 Big Endian with BOM

</dd>
<dt>UTF-32LE</dt><dd>UTF-32 Little Endian without BOM

</dd>
<dt>UTF-32LE-BOM</dt><dd>UTF-32 Little Endian with BOM

</dd>
<dt>UTF8-MAC</dt><dd>NKDed UTF-8, a.k.a. UTF8-NFD (input only)

</dd>
</dl>
<h3>&#8212;fb-{skip, html, xml, perl, java, subchar}</h3>
<p>
Specify the way that nkf handles unassigned characters. Without this
option, &#8212;fb-skip is assumed.
</p>
<h3>&#8212;prefix= <tt>escape character</tt> <tt>target character</tt> ..</h3>
<p>
When nkf converts to Shift_JIS, nkf adds a specified escape character to
specified 2nd byte of Shift_JIS characters. 1st byte of argument is the
escape character and following bytes are target characters.
</p>
<h3>&#8212;no-cp932ext</h3>
<p>
Handle the characters extended in CP932 as unassigned characters.
</p>
<h2>&#8212;no-best-fit-chars</h2>
<p>
When Unicode to Encoded byte conversion, don&#8217;t convert characters
which is not round trip safe. When Unicode to Unicode conversion, with this
and -x option, nkf can be used as UTF converter. (In other words, without
this and -x option, nkf doesn&#8217;t save some characters)
</p>
<p>
When nkf convert string which related to path, you should use this opion.
</p>
<h3>&#8212;cap-input</h3>
<p>
Decode hex encoded characters.
</p>
<h3>&#8212;url-input</h3>
<p>
Unescape percent escaped characters.
</p>
<h3>&#8212;</h3>
<p>
Ignore rest of -option.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M006924">guess</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M006923">nkf</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">AUTO</td>
            <td>=</td>
            <td class="attr-value">Qnil</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NOCONV</td>
            <td>=</td>
            <td class="attr-value">Qnil</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UNKNOWN</td>
            <td>=</td>
            <td class="attr-value">Qnil</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">BINARY</td>
            <td>=</td>
            <td class="attr-value">rb_enc_from_encoding(rb_nkf_enc_get(&quot;BINARY&quot;))</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ASCII</td>
            <td>=</td>
            <td class="attr-value">rb_enc_from_encoding(rb_nkf_enc_get(&quot;US-ASCII&quot;))</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">JIS</td>
            <td>=</td>
            <td class="attr-value">rb_enc_from_encoding(rb_nkf_enc_get(&quot;ISO-2022-JP&quot;))</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">EUC</td>
            <td>=</td>
            <td class="attr-value">rb_enc_from_encoding(rb_nkf_enc_get(&quot;EUC-JP&quot;))</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SJIS</td>
            <td>=</td>
            <td class="attr-value">rb_enc_from_encoding(rb_nkf_enc_get(&quot;Shift_JIS&quot;))</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UTF8</td>
            <td>=</td>
            <td class="attr-value">rb_enc_from_encoding(rb_utf8_encoding())</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UTF16</td>
            <td>=</td>
            <td class="attr-value">rb_enc_from_encoding(rb_nkf_enc_get(&quot;UTF-16BE&quot;))</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UTF32</td>
            <td>=</td>
            <td class="attr-value">rb_enc_from_encoding(rb_nkf_enc_get(&quot;UTF-32BE&quot;))</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">rb_str_new2(RUBY_NKF_VERSION)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Full version string of nkf
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NKF_VERSION</td>
            <td>=</td>
            <td class="attr-value">rb_str_new2(NKF_VERSION)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Version of nkf
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NKF_RELEASE_DATE</td>
            <td>=</td>
            <td class="attr-value">rb_str_new2(NKF_RELEASE_DATE)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Release date of nkf
</p>
</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M006924">
                    
                    <a name="M006924"></a><b>NKF.guess(str)  => encoding
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Returns guessed encoding of <em>str</em> by nkf routine.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M006924_source')" id="l_M006924_source">show</a>
                        
                    </p>
                    <div id="M006924_source" class="dyn-source">
                        <pre>static VALUE
rb_nkf_guess(VALUE obj, VALUE src)
{
    reinit();

    input_ctr = 0;
    StringValue(src);
    input = (unsigned char *)RSTRING_PTR(src);
    i_len = RSTRING_LENINT(src);

    guess_f = TRUE;
    kanji_convert( NULL );
    guess_f = FALSE;

    return rb_enc_from_encoding(rb_nkf_enc_get(get_guessed_code()));
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M006923">
                    
                    <a name="M006923"></a><b>NKF.nkf(opt, str)   => string
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Convert <em>str</em> and return converted result. Conversion details are
specified by <em>opt</em> as <a href="String.html">String</a>.
</p>
<pre>
   require 'nkf'
   output = NKF.nkf(&quot;-s&quot;, input)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M006923_source')" id="l_M006923_source">show</a>
                        
                    </p>
                    <div id="M006923_source" class="dyn-source">
                        <pre>static VALUE
rb_nkf_convert(VALUE obj, VALUE opt, VALUE src)
{
    volatile VALUE tmp;
    reinit();
    StringValue(opt);
    nkf_split_options(RSTRING_PTR(opt));
    if (!output_encoding) rb_raise(rb_eArgError, &quot;no output encoding given&quot;);

    switch (nkf_enc_to_index(output_encoding)) {
    case UTF_8_BOM:    output_encoding = nkf_enc_from_index(UTF_8); break;
    case UTF_16BE_BOM: output_encoding = nkf_enc_from_index(UTF_16BE); break;
    case UTF_16LE_BOM: output_encoding = nkf_enc_from_index(UTF_16LE); break;
    case UTF_32BE_BOM: output_encoding = nkf_enc_from_index(UTF_32BE); break;
    case UTF_32LE_BOM: output_encoding = nkf_enc_from_index(UTF_32LE); break;
    }
    output_bom_f = FALSE;

    incsize = INCSIZE;

    input_ctr = 0;
    StringValue(src);
    input = (unsigned char *)RSTRING_PTR(src);
    i_len = RSTRING_LENINT(src);
    tmp = result = rb_str_new(0, i_len*3 + 10);

    output_ctr = 0;
    output     = (unsigned char *)RSTRING_PTR(result);
    o_len      = RSTRING_LENINT(result);
    *output    = '\0';

    kanji_convert(NULL);
    rb_str_set_len(result, output_ctr);
    OBJ_INFECT(result, src);

    if (mimeout_f)
        rb_enc_associate(result, rb_usascii_encoding());
    else
        rb_enc_associate(result, rb_nkf_enc_get(nkf_enc_name(output_encoding)));

    return result;
}</pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    