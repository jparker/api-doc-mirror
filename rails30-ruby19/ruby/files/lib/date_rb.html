<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>date.rb</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            date.rb
        </h1>
        <ul class="files">
            <li>lib/date.rb</li>
            <li>Last modified: 2010-09-02 19:37:30 +0000</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
date.rb - date and time library
</p>
<p>
Author: Tadayoshi Funaba 1998-2010
</p>
<p>
Documentation: William Webber <william@williamwebber.com>
</p>
<h2>Overview</h2>
<p>
This file provides two classes for working with dates and times.
</p>
<p>
The first class, <a href="../../classes/Date.html">Date</a>, represents
dates. It works with years, months, weeks, and days. See the <a
href="../../classes/Date.html">Date</a> class documentation for more
details.
</p>
<p>
The second, <a href="../../classes/DateTime.html">DateTime</a>, extends <a
href="../../classes/Date.html">Date</a> to include hours, minutes, seconds,
and fractions of a second. It provides basic support for time zones. See
the <a href="../../classes/DateTime.html">DateTime</a> class documentation
for more details.
</p>
<h3>Ways of calculating the date.</h3>
<p>
In common usage, the date is reckoned in years since or before the Common
Era (CE/BCE, also known as AD/BC), then as a month and day-of-the-month
within the current year. This is known as the <b>Civil</b> <b>Date</b>, and
abbreviated as <tt>civil</tt> in the <a
href="../../classes/Date.html">Date</a> class.
</p>
<p>
Instead of year, month-of-the-year, and day-of-the-month, the date can also
be reckoned in terms of year and day-of-the-year. This is known as the
<b>Ordinal</b> <b>Date</b>, and is abbreviated as <tt>ordinal</tt> in the
<a href="../../classes/Date.html">Date</a> class. (Note that referring to
this as the Julian date is incorrect.)
</p>
<p>
The date can also be reckoned in terms of year, week-of-the-year, and
day-of-the-week. This is known as the <b>Commercial</b> <b>Date</b>, and is
abbreviated as <tt>commercial</tt> in the <a
href="../../classes/Date.html">Date</a> class. The commercial week runs
Monday (day-of-the-week 1) to Sunday (day-of-the-week 7), in contrast to
the civil week which runs Sunday (day-of-the-week 0) to Saturday
(day-of-the-week 6). The first week of the commercial year starts on the
Monday on or before January 1, and the commercial year itself starts on
this Monday, not January 1.
</p>
<p>
For scientific purposes, it is convenient to refer to a date simply as a
day count, counting from an arbitrary initial day. The date first chosen
for this was January 1, 4713 BCE. <a href="../../classes/A.html">A</a>
count of days from this date is the <b>Julian</b> <b>Day</b> <b>Number</b>
or <b>Julian</b> <b>Date</b>, which is abbreviated as <tt>jd</tt> in the <a
href="../../classes/Date.html">Date</a> class. This is in local time, and
counts from midnight on the initial day. The stricter usage is in UTC, and
counts from midday on the initial day. This is referred to in the <a
href="../../classes/Date.html">Date</a> class as the <b>Astronomical</b>
<b>Julian</b> <b>Day</b> <b>Number</b>, and abbreviated as <tt>ajd</tt>. In
the <a href="../../classes/Date.html">Date</a> class, the Astronomical
Julian Day Number includes fractional days.
</p>
<p>
Another absolute day count is the <b>Modified</b> <b>Julian</b> <b>Day</b>
<b>Number</b>, which takes November 17, 1858 as its initial day. This is
abbreviated as <tt>mjd</tt> in the <a
href="../../classes/Date.html">Date</a> class. There is also an
<b>Astronomical</b> <b>Modified</b> <b>Julian</b> <b>Day</b> <b>Number</b>,
which is in UTC and includes fractional days. This is abbreviated as
<tt>amjd</tt> in the <a href="../../classes/Date.html">Date</a> class. Like
the Modified Julian Day Number (and unlike the Astronomical Julian Day
Number), it counts from midnight.
</p>
<p>
Alternative calendars such as the Chinese Lunar Calendar, the Islamic
Calendar, or the French Revolutionary Calendar are not supported by the <a
href="../../classes/Date.html">Date</a> class; nor are calendars that are
based on an Era different from the Common Era, such as the Japanese
Imperial Calendar or the Republic of China Calendar.
</p>
<h3>Calendar Reform</h3>
<p>
The standard civil year is 365 days long. However, the solar year is
fractionally longer than this. To account for this, a <b>leap</b>
<b>year</b> is occasionally inserted. This is a year with 366 days, the
extra day falling on February 29. In the early days of the civil calendar,
every fourth year without exception was a leap year. This way of reckoning
leap years is the <b>Julian</b> <b>Calendar</b>.
</p>
<p>
However, the solar year is marginally shorter than 365 1/4 days, and so the
<b>Julian</b> <b>Calendar</b> gradually ran slow over the centuries. To
correct this, every 100th year (but not every 400th year) was excluded as a
leap year. This way of reckoning leap years, which we use today, is the
<b>Gregorian</b> <b>Calendar</b>.
</p>
<p>
The Gregorian Calendar was introduced at different times in different
regions. The day on which it was introduced for a particular region is the
<b>Day</b> <b>of</b> <b>Calendar</b> <b>Reform</b> for that region. This is
abbreviated as <tt>sg</tt> (for Start of Gregorian calendar) in the <a
href="../../classes/Date.html">Date</a> class.
</p>
<p>
Two such days are of particular significance. The first is October 15,
1582, which was the Day of Calendar Reform for Italy and most Catholic
countries. The second is September 14, 1752, which was the Day of Calendar
Reform for England and its colonies (including what is now the United
States). These two dates are available as the constants Date::ITALY and
Date::ENGLAND, respectively. (By comparison, Germany and Holland, less
Catholic than Italy but less stubborn than England, changed over in 1698;
Sweden in 1753; Russia not till 1918, after the Revolution; and Greece in
1923. Many Orthodox churches still use the Julian Calendar. <a
href="../../classes/A.html">A</a> complete list of Days of Calendar Reform
can be found at <a
href="http://www.polysyllabic.com/GregConv.html.">www.polysyllabic.com/GregConv.html.</a>)
</p>
<p>
Switching from the Julian to the Gregorian calendar involved skipping a
number of days to make up for the accumulated lag, and the later the switch
was (or is) done, the more days need to be skipped. So in 1582 in Italy,
4th October was followed by 15th October, skipping 10 days; in 1752 in
England, 2nd September was followed by 14th September, skipping 11 days;
and if I decided to switch from Julian to Gregorian Calendar this midnight,
I would go from 27th July 2003 (Julian) today to 10th August 2003
(Gregorian) tomorrow, skipping 13 days. The <a
href="../../classes/Date.html">Date</a> class is aware of this gap, and a
supposed date that would fall in the middle of it is regarded as invalid.
</p>
<p>
The Day of Calendar Reform is relevant to all date representations
involving years. It is not relevant to the Julian Day Numbers, except for
converting between them and year-based representations.
</p>
<p>
In the <a href="../../classes/Date.html">Date</a> and <a
href="../../classes/DateTime.html">DateTime</a> classes, the Day of
Calendar Reform or <tt>sg</tt> can be specified a number of ways. First, it
can be as the Julian Day Number of the Day of Calendar Reform. Second, it
can be using the constants Date::ITALY or Date::ENGLAND; these are in fact
the Julian Day Numbers of the Day of Calendar Reform of the respective
regions. Third, it can be as the constant Date::JULIAN, which means to
always use the Julian Calendar. Finally, it can be as the constant
Date::GREGORIAN, which means to always use the Gregorian Calendar.
</p>
<p>
Note: in the Julian Calendar, New Years Day was March 25. The <a
href="../../classes/Date.html">Date</a> class does not follow this
convention.
</p>
<h3><a href="../../classes/Time.html">Time</a> Zones</h3>
<p>
<a href="../../classes/DateTime.html">DateTime</a> objects support a simple
representation of time zones. <a href="../../classes/Time.html">Time</a>
zones are represented as an offset from UTC, as a fraction of a day. This
offset is the how much local time is later (or earlier) than UTC. UTC
offset 0 is centred on England (also known as GMT). As you travel east, the
offset increases until you reach the dateline in the middle of the Pacific
Ocean; as you travel west, the offset decreases. This offset is abbreviated
as <tt>of</tt> in the <a href="../../classes/Date.html">Date</a> class.
</p>
<p>
This simple representation of time zones does not take into account the
common practice of Daylight Savings <a
href="../../classes/Time.html">Time</a> or Summer <a
href="../../classes/Time.html">Time</a>.
</p>
<p>
Most <a href="../../classes/DateTime.html">DateTime</a> methods return the
date and the time in local time. The two exceptions are ajd() and amjd(),
which return the date and time in UTC time, including fractional days.
</p>
<p>
The <a href="../../classes/Date.html">Date</a> class does not support time
zone offsets, in that there is no way to create a <a
href="../../classes/Date.html">Date</a> object with a time zone. However,
methods of the <a href="../../classes/Date.html">Date</a> class when used
by a <a href="../../classes/DateTime.html">DateTime</a> instance will use
the time zone offset of this instance.
</p>
<h2>Examples of use</h2>
<h3>Print out the date of every Sunday between two dates.</h3>
<pre>
    def print_sundays(d1, d2)
        d1 +=1 while (d1.wday != 0)
        d1.step(d2, 7) do |date|
            puts &quot;#{Date::MONTHNAMES[date.mon]} #{date.day}&quot;
        end
    end

    print_sundays(Date::civil(2003, 4, 8), Date::civil(2003, 5, 23))
</pre>
<h3>Calculate how many seconds to go till midnight on New Year&#8217;s Day.</h3>
<pre>
    def secs_to_new_year(now = DateTime::now())
        new_year = DateTime.new(now.year + 1, 1, 1)
        dif = new_year - now
        hours, mins, secs, ignore_fractions = Date::day_fraction_to_time(dif)
        return hours * 60 * 60 + mins * 60 + secs
    end

    puts secs_to_new_year()
</pre>

    </div>
    

    
    <div class="sectiontitle">Required Files</div>
    <ul>
        
        <li>date/format</li>
        
        <li>enumerator</li>
        
    </ul>
    

    
    

    
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="../../classes/Date.html">Date</a></li>
        
        <li><span class="type">CLASS</span> <a href="../../classes/DateTime.html">DateTime</a></li>
        
        <li><span class="type">CLASS</span> <a href="../../classes/Time.html">Time</a></li>
        
    </ul>
    

    

    

    
</div>
    </div>
  </body>
</html>