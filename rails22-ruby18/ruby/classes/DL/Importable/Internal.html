<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>DL::Importable::Internal</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            DL::Importable::Internal 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/ext/dl/lib/dl/struct_rb.html">ext/dl/lib/dl/struct.rb</a></li>
            
            <li><a href="../../../files/ext/dl/lib/dl/import_rb.html">ext/dl/lib/dl/import.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>#</dt>
        <dd>
            <ul>
                
                <li><a href="#M007725">[]</a>,</li>
                
                <li><a href="#M007734">_args_</a>,</li>
                
                <li><a href="#M007735">_retval_</a></li>
                
            </ul>
        </dd>
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M007730">callback</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M007698">define_struct</a>,</li>
                
                <li><a href="#M007700">define_union</a>,</li>
                
                <li><a href="#M007727">dllink</a>,</li>
                
                <li><a href="#M007726">dlload</a></li>
                
            </ul>
        </dd>
    
        <dt>E</dt>
        <dd>
            <ul>
                
                <li><a href="#M007736">encode_argument_types</a>,</li>
                
                <li><a href="#M007729">extern</a></li>
                
            </ul>
        </dd>
    
        <dt>I</dt>
        <dd>
            <ul>
                
                <li><a href="#M007733">import</a>,</li>
                
                <li><a href="#M007724">init_sym</a>,</li>
                
                <li><a href="#M007723">init_types</a></li>
                
            </ul>
        </dd>
    
        <dt>P</dt>
        <dd>
            <ul>
                
                <li><a href="#M007728">parse_cproto</a></li>
                
            </ul>
        </dd>
    
        <dt>S</dt>
        <dd>
            <ul>
                
                <li><a href="#M007699">struct</a>,</li>
                
                <li><a href="#M007732">symbol</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M007731">typealias</a></li>
                
            </ul>
        </dd>
    
        <dt>U</dt>
        <dd>
            <ul>
                
                <li><a href="#M007701">union</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    
    <div class="sectiontitle">Classes and Modules</div>
    <ul>
        
        <li><span class="type">CLASS</span> <a href="Internal/Memory.html">DL::Importable::Internal::Memory</a></li>
        
        <li><span class="type">CLASS</span> <a href="Internal/Struct.html">DL::Importable::Internal::Struct</a></li>
        
        <li><span class="type">CLASS</span> <a href="Internal/Union.html">DL::Importable::Internal::Union</a></li>
        
    </ul>
    

    

    

    
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M007725">
                    
                    <a name="M007725"></a><b>[]</b>(name)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007725_source')" id="l_M007725_source">show</a>
                        
                    </p>
                    <div id="M007725_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 19</span>
19:       <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">name</span>)
20:         <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@SYM</span>[<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>][<span class="ruby-value">0</span>]
21:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007734">
                    
                    <a name="M007734"></a><b>_args_</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007734_source')" id="l_M007734_source">show</a>
                        
                    </p>
                    <div id="M007734_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 180</span>
180:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_args_</span>
181:         <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@args</span>
182:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007735">
                    
                    <a name="M007735"></a><b>_retval_</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007735_source')" id="l_M007735_source">show</a>
                        
                    </p>
                    <div id="M007735_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 184</span>
184:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_retval_</span>
185:         <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@retval</span>
186:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007730">
                    
                    <a name="M007730"></a><b>callback</b>(proto)
                    
                </div>
                
                <div class="description">
                  <p>
example:
</p>
<pre>
  callback &quot;int method_name(int, char*)&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007730_source')" id="l_M007730_source">show</a>
                        
                    </p>
                    <div id="M007730_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 67</span>
67:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">callback</span>(<span class="ruby-identifier">proto</span>)
68:         <span class="ruby-identifier">func</span>,<span class="ruby-identifier">ret</span>,<span class="ruby-identifier">args</span> = <span class="ruby-identifier">parse_cproto</span>(<span class="ruby-identifier">proto</span>)
69: 
70:         <span class="ruby-identifier">init_types</span>()
71:         <span class="ruby-identifier">init_sym</span>()
72: 
73:         <span class="ruby-identifier">rty</span>,<span class="ruby-identifier">renc</span>,<span class="ruby-identifier">rdec</span> = <span class="ruby-ivar">@types</span>.<span class="ruby-identifier">encode_return_type</span>(<span class="ruby-identifier">ret</span>)
74:         <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">rty</span> )
75:           <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;unsupported type: #{ret}&quot;</span>)
76:         <span class="ruby-keyword kw">end</span>
77:         <span class="ruby-identifier">ty</span>,<span class="ruby-identifier">enc</span>,<span class="ruby-identifier">dec</span> = <span class="ruby-identifier">encode_argument_types</span>(<span class="ruby-identifier">args</span>)
78:         <span class="ruby-identifier">symty</span> = <span class="ruby-identifier">rty</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ty</span>
79: 
80:         <span class="ruby-identifier">module_eval</span>(<span class="ruby-node">&quot;module_function :#{func}&quot;</span>)
81:         <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">module_eval</span>([
82:           <span class="ruby-node">&quot;DL::callback(\&quot;#{symty}\&quot;){|*args|&quot;</span>,
83:           <span class="ruby-node">&quot;  sym,rdec,enc,dec  = @SYM['#{func}']&quot;</span>,
84:           <span class="ruby-value str">&quot;  args = enc.call(args) if enc&quot;</span>,
85:           <span class="ruby-node">&quot;  r,rs = #{func}(*args)&quot;</span>,
86:           <span class="ruby-value str">&quot;  r  = renc.call(r) if rdec&quot;</span>,
87:           <span class="ruby-value str">&quot;  rs = dec.call(rs) if (dec &amp;&amp; rs)&quot;</span>,
88:           <span class="ruby-value str">&quot;  @retval = r&quot;</span>,
89:           <span class="ruby-value str">&quot;  @args   = rs&quot;</span>,
90:           <span class="ruby-value str">&quot;  r&quot;</span>,
91:           <span class="ruby-value str">&quot;}&quot;</span>,
92:         ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))
93: 
94:         <span class="ruby-ivar">@SYM</span>[<span class="ruby-identifier">func</span>] = [<span class="ruby-identifier">sym</span>,<span class="ruby-identifier">rdec</span>,<span class="ruby-identifier">enc</span>,<span class="ruby-identifier">dec</span>]
95: 
96:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sym</span>
97:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007698">
                    
                    <a name="M007698"></a><b>define_struct</b>(contents)
                    
                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Internal.html#M007699">struct</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007698_source')" id="l_M007698_source">show</a>
                        
                    </p>
                    <div id="M007698_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/struct.rb, line 9</span>
 9:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_struct</span>(<span class="ruby-identifier">contents</span>)
10:         <span class="ruby-identifier">init_types</span>()
11:         <span class="ruby-constant">Struct</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@types</span>, <span class="ruby-identifier">contents</span>)
12:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007700">
                    
                    <a name="M007700"></a><b>define_union</b>(contents)
                    
                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Internal.html#M007701">union</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007700_source')" id="l_M007700_source">show</a>
                        
                    </p>
                    <div id="M007700_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/struct.rb, line 15</span>
15:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_union</span>(<span class="ruby-identifier">contents</span>)
16:         <span class="ruby-identifier">init_types</span>()
17:         <span class="ruby-constant">Union</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@types</span>, <span class="ruby-identifier">contents</span>)
18:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007727">
                    
                    <a name="M007727"></a><b>dllink</b>(*libnames)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Internal.html#M007726">dlload</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M007726">
                    
                    <a name="M007726"></a><b>dlload</b>(*libnames)
                    
                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Internal.html#M007727">dllink</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007726_source')" id="l_M007726_source">show</a>
                        
                    </p>
                    <div id="M007726_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 23</span>
23:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dlload</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">libnames</span>)
24:         <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@LIBS</span>) )
25:           <span class="ruby-ivar">@LIBS</span> = []
26:         <span class="ruby-keyword kw">end</span>
27:         <span class="ruby-identifier">libnames</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">libname</span><span class="ruby-operator">|</span>
28:           <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-constant">LIB_MAP</span>[<span class="ruby-identifier">libname</span>] )
29:             <span class="ruby-constant">LIB_MAP</span>[<span class="ruby-identifier">libname</span>] = <span class="ruby-constant">DL</span>.<span class="ruby-identifier">dlopen</span>(<span class="ruby-identifier">libname</span>)
30:           <span class="ruby-keyword kw">end</span>
31:           <span class="ruby-ivar">@LIBS</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">LIB_MAP</span>[<span class="ruby-identifier">libname</span>])
32:         }
33:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007736">
                    
                    <a name="M007736"></a><b>encode_argument_types</b>(tys)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007736_source')" id="l_M007736_source">show</a>
                        
                    </p>
                    <div id="M007736_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 188</span>
188:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_argument_types</span>(<span class="ruby-identifier">tys</span>)
189:         <span class="ruby-identifier">init_types</span>()
190:         <span class="ruby-identifier">encty</span> = []
191:         <span class="ruby-identifier">enc</span> = <span class="ruby-keyword kw">nil</span>
192:         <span class="ruby-identifier">dec</span> = <span class="ruby-keyword kw">nil</span>
193:         <span class="ruby-identifier">tys</span>.<span class="ruby-identifier">each_with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">ty</span>,<span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
194:           <span class="ruby-identifier">ty</span>,<span class="ruby-identifier">c1</span>,<span class="ruby-identifier">c2</span> = <span class="ruby-ivar">@types</span>.<span class="ruby-identifier">encode_argument_type</span>(<span class="ruby-identifier">ty</span>)
195:           <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">ty</span> )
196:             <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;unsupported type: #{ty}&quot;</span>)
197:           <span class="ruby-keyword kw">end</span>
198:           <span class="ruby-identifier">encty</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ty</span>)
199:           <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">enc</span> )
200:             <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">c1</span> )
201:               <span class="ruby-identifier">conv1</span> = <span class="ruby-identifier">enc</span>
202:               <span class="ruby-identifier">enc</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">conv1</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>); <span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>]); <span class="ruby-identifier">v</span>}
203:             <span class="ruby-keyword kw">end</span>
204:           <span class="ruby-keyword kw">else</span>
205:             <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">c1</span> )
206:               <span class="ruby-identifier">enc</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>]); <span class="ruby-identifier">v</span>}
207:             <span class="ruby-keyword kw">end</span>
208:           <span class="ruby-keyword kw">end</span>
209:           <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">dec</span> )
210:             <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">c2</span> )
211:               <span class="ruby-identifier">conv2</span> = <span class="ruby-identifier">dec</span>
212:               <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">conv2</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>); <span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>]); <span class="ruby-identifier">v</span>}
213:             <span class="ruby-keyword kw">end</span>
214:           <span class="ruby-keyword kw">else</span>
215:             <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">c2</span> )
216:               <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>]); <span class="ruby-identifier">v</span>}
217:             <span class="ruby-keyword kw">end</span>
218:           <span class="ruby-keyword kw">end</span>
219:         }
220:         <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">encty</span>.<span class="ruby-identifier">join</span>, <span class="ruby-identifier">enc</span>, <span class="ruby-identifier">dec</span>]
221:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007729">
                    
                    <a name="M007729"></a><b>extern</b>(proto)
                    
                </div>
                
                <div class="description">
                  <p>
example:
</p>
<pre>
  extern &quot;int strlen(char*)&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007729_source')" id="l_M007729_source">show</a>
                        
                    </p>
                    <div id="M007729_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 59</span>
59:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extern</span>(<span class="ruby-identifier">proto</span>)
60:         <span class="ruby-identifier">func</span>,<span class="ruby-identifier">ret</span>,<span class="ruby-identifier">args</span> = <span class="ruby-identifier">parse_cproto</span>(<span class="ruby-identifier">proto</span>)
61:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">import</span>(<span class="ruby-identifier">func</span>, <span class="ruby-identifier">ret</span>, <span class="ruby-identifier">args</span>)
62:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007733">
                    
                    <a name="M007733"></a><b>import</b>(name, rettype, argtypes = nil)
                    
                </div>
                
                <div class="description">
                  <p>
example:
</p>
<pre>
  import(&quot;get_length&quot;, &quot;int&quot;, [&quot;void*&quot;, &quot;int&quot;])
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007733_source')" id="l_M007733_source">show</a>
                        
                    </p>
                    <div id="M007733_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 134</span>
134:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">import</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">rettype</span>, <span class="ruby-identifier">argtypes</span> = <span class="ruby-keyword kw">nil</span>)
135:         <span class="ruby-identifier">init_types</span>()
136:         <span class="ruby-identifier">init_sym</span>()
137: 
138:         <span class="ruby-identifier">rty</span>,<span class="ruby-identifier">_</span>,<span class="ruby-identifier">rdec</span> = <span class="ruby-ivar">@types</span>.<span class="ruby-identifier">encode_return_type</span>(<span class="ruby-identifier">rettype</span>)
139:         <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">rty</span> )
140:           <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;unsupported type: #{rettype}&quot;</span>)
141:         <span class="ruby-keyword kw">end</span>
142:         <span class="ruby-identifier">ty</span>,<span class="ruby-identifier">enc</span>,<span class="ruby-identifier">dec</span> = <span class="ruby-identifier">encode_argument_types</span>(<span class="ruby-identifier">argtypes</span>)
143:         <span class="ruby-identifier">symty</span> = <span class="ruby-identifier">rty</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ty</span>
144: 
145:         <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">symbol</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">symty</span>)
146: 
147:         <span class="ruby-identifier">mname</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">dup</span>
148:         <span class="ruby-keyword kw">if</span>( <span class="ruby-value">?A</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">mname</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">mname</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-value">?Z</span> )
149:           <span class="ruby-identifier">mname</span>[<span class="ruby-value">0</span>,<span class="ruby-value">1</span>] = <span class="ruby-identifier">mname</span>[<span class="ruby-value">0</span>,<span class="ruby-value">1</span>].<span class="ruby-identifier">downcase</span>
150:         <span class="ruby-keyword kw">end</span>
151:         <span class="ruby-ivar">@SYM</span>[<span class="ruby-identifier">mname</span>] = [<span class="ruby-identifier">sym</span>,<span class="ruby-identifier">rdec</span>,<span class="ruby-identifier">enc</span>,<span class="ruby-identifier">dec</span>]
152:         
153:         <span class="ruby-identifier">module_eval</span> [
154:           <span class="ruby-node">&quot;def #{mname}(*args)&quot;</span>,
155:           <span class="ruby-node">&quot;  sym,rdec,enc,dec  = @SYM['#{mname}']&quot;</span>,
156:           <span class="ruby-value str">&quot;  args = enc.call(args) if enc&quot;</span>,
157:           <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">$DEBUG</span> )
158:             <span class="ruby-node">&quot;  p \&quot;[DL] call #{mname} with \#{args.inspect}\&quot;&quot;</span>
159:           <span class="ruby-keyword kw">else</span>
160:             <span class="ruby-value str">&quot;&quot;</span>
161:           <span class="ruby-keyword kw">end</span>,
162:           <span class="ruby-value str">&quot;  r,rs = sym.call(*args)&quot;</span>,
163:           <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">$DEBUG</span> )
164:             <span class="ruby-value str">&quot;  p \&quot;[DL] retval=\#{r.inspect} args=\#{rs.inspect}\&quot;&quot;</span>
165:           <span class="ruby-keyword kw">else</span>
166:             <span class="ruby-value str">&quot;&quot;</span>
167:           <span class="ruby-keyword kw">end</span>,
168:           <span class="ruby-value str">&quot;  r  = rdec.call(r) if rdec&quot;</span>,
169:           <span class="ruby-value str">&quot;  rs = dec.call(rs) if dec&quot;</span>,
170:           <span class="ruby-value str">&quot;  @retval = r&quot;</span>,
171:           <span class="ruby-value str">&quot;  @args   = rs&quot;</span>,
172:           <span class="ruby-value str">&quot;  return r&quot;</span>,
173:           <span class="ruby-value str">&quot;end&quot;</span>,
174:           <span class="ruby-node">&quot;module_function :#{mname}&quot;</span>,
175:         ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
176: 
177:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sym</span>
178:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007724">
                    
                    <a name="M007724"></a><b>init_sym</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007724_source')" id="l_M007724_source">show</a>
                        
                    </p>
                    <div id="M007724_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 15</span>
15:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_sym</span>()
16:         <span class="ruby-ivar">@SYM</span> <span class="ruby-operator">||=</span> {}
17:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007723">
                    
                    <a name="M007723"></a><b>init_types</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007723_source')" id="l_M007723_source">show</a>
                        
                    </p>
                    <div id="M007723_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 11</span>
11:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_types</span>()
12:         <span class="ruby-ivar">@types</span> <span class="ruby-operator">||=</span> <span class="ruby-operator">::</span><span class="ruby-constant">DL</span><span class="ruby-operator">::</span><span class="ruby-constant">Types</span>.<span class="ruby-identifier">new</span>
13:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007728">
                    
                    <a name="M007728"></a><b>parse_cproto</b>(proto)
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007728_source')" id="l_M007728_source">show</a>
                        
                    </p>
                    <div id="M007728_source" class="dyn-source">
                        <pre>    <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 36</span>
36:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_cproto</span>(<span class="ruby-identifier">proto</span>)
37:         <span class="ruby-identifier">proto</span> = <span class="ruby-identifier">proto</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\s+/</span>, <span class="ruby-value str">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>
38:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">proto</span>
39:         <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^([\d\w\*_\s]+)\(([\d\w\*_\s\,\[\]]*)\)$/</span>
40:           <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">$1</span>
41:           <span class="ruby-identifier">args</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">strip</span>()
42:           <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s+/</span>)
43:           <span class="ruby-identifier">args</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s*,\s*/</span>)
44:           <span class="ruby-identifier">func</span> = <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">pop</span>()
45:           <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\*/</span> )
46:             <span class="ruby-identifier">func</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/^\*+/</span>,<span class="ruby-value str">&quot;&quot;</span>)
47:             <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value str">&quot;*&quot;</span>)
48:           <span class="ruby-keyword kw">end</span>
49:           <span class="ruby-identifier">ret</span>  = <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>)
50:           <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">func</span>, <span class="ruby-identifier">ret</span>, <span class="ruby-identifier">args</span>]
51:         <span class="ruby-keyword kw">else</span>
52:           <span class="ruby-identifier">raise</span>(<span class="ruby-constant">RuntimeError</span>,<span class="ruby-node">&quot;can't parse the function prototype: #{proto}&quot;</span>)
53:         <span class="ruby-keyword kw">end</span>
54:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007699">
                    
                    <a name="M007699"></a><b>struct</b>(contents)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Internal.html#M007698">define_struct</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M007732">
                    
                    <a name="M007732"></a><b>symbol</b>(name, ty = nil)
                    
                </div>
                
                <div class="description">
                  <p>
example:
</p>
<pre>
 symbol &quot;foo_value&quot;
 symbol &quot;foo_func&quot;, &quot;IIP&quot;
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007732_source')" id="l_M007732_source">show</a>
                        
                    </p>
                    <div id="M007732_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 112</span>
112:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">symbol</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ty</span> = <span class="ruby-keyword kw">nil</span>)
113:         <span class="ruby-identifier">sym</span> = <span class="ruby-keyword kw">nil</span>
114:         <span class="ruby-ivar">@LIBS</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">lib</span><span class="ruby-operator">|</span>
115:           <span class="ruby-keyword kw">begin</span>
116:             <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">ty</span> )
117:               <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">lib</span>[<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ty</span>]
118:             <span class="ruby-keyword kw">else</span>
119:               <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">lib</span>[<span class="ruby-identifier">name</span>]
120:             <span class="ruby-keyword kw">end</span>
121:           <span class="ruby-keyword kw">rescue</span>
122:             <span class="ruby-keyword kw">next</span>
123:           <span class="ruby-keyword kw">end</span>
124:         }
125:         <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">sym</span> )
126:           <span class="ruby-identifier">raise</span>(<span class="ruby-constant">RuntimeError</span>, <span class="ruby-node">&quot;can't find the symbol `#{name}'&quot;</span>)
127:         <span class="ruby-keyword kw">end</span>
128:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sym</span>
129:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007731">
                    
                    <a name="M007731"></a><b>typealias</b>(alias_type, ty1, enc1=nil, dec1=nil, ty2=nil, enc2=nil, dec2=nil)
                    
                </div>
                
                <div class="description">
                  <p>
example:
</p>
<pre>
 typealias(&quot;uint&quot;, &quot;unsigned int&quot;)
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007731_source')" id="l_M007731_source">show</a>
                        
                    </p>
                    <div id="M007731_source" class="dyn-source">
                        <pre>     <span class="ruby-comment cmt"># File ext/dl/lib/dl/import.rb, line 102</span>
102:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">typealias</span>(<span class="ruby-identifier">alias_type</span>, <span class="ruby-identifier">ty1</span>, <span class="ruby-identifier">enc1</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">dec1</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">ty2</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">enc2</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">dec2</span>=<span class="ruby-keyword kw">nil</span>)
103:         <span class="ruby-identifier">init_types</span>()
104:         <span class="ruby-ivar">@types</span>.<span class="ruby-identifier">typealias</span>(<span class="ruby-identifier">alias_type</span>, <span class="ruby-identifier">ty1</span>, <span class="ruby-identifier">enc1</span>, <span class="ruby-identifier">dec1</span>,
105:                                      <span class="ruby-identifier">ty2</span><span class="ruby-operator">||</span><span class="ruby-identifier">ty1</span>, <span class="ruby-identifier">enc2</span>, <span class="ruby-identifier">dec2</span>)
106:       <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007701">
                    
                    <a name="M007701"></a><b>union</b>(contents)
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Internal.html#M007700">define_union</a>
</p>

                </div>
                
                
                
            </div>
            
</div>
    </div>
  </body>
</html>    