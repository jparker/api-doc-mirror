<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>NKF</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Module</span> 
            NKF 
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/ext/nkf/nkf_c.html">ext/nkf/nkf.c</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
hoge
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>G</dt>
        <dd>
            <ul>
                
                <li><a href="#M007186">guess1</a>,</li>
                
                <li><a href="#M007187">guess2</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M007185">nkf</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    
    <div class="sectiontitle">Constants</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class="attr-name">AUTO</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_AUTO)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Auto-Detect
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">JIS</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_JIS)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
ISO-2022-JP
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">EUC</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_EUC)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
EUC-JP
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">SJIS</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_SJIS)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Shift_JIS
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">BINARY</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_BINARY)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
<a href="NKF.html#BINARY">BINARY</a>
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NOCONV</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_NOCONV)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
No conversion
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">ASCII</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_ASCII)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
<a href="NKF.html#ASCII">ASCII</a>
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UTF8</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_UTF8)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
UTF-8
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UTF16</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_UTF16)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
UTF-16
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UTF32</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_UTF32)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
UTF-32
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">UNKNOWN</td>
            <td>=</td>
            <td class="attr-value">INT2FIX(_UNKNOWN)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
<a href="NKF.html#UNKNOWN">UNKNOWN</a>
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">VERSION</td>
            <td>=</td>
            <td class="attr-value">rb_str_new2(RUBY_NKF_VERSION)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Full version string of nkf
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NKF_VERSION</td>
            <td>=</td>
            <td class="attr-value">rb_str_new2(NKF_VERSION)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Version of nkf
</p>
</td>
        </tr>
        
        
        <tr valign='top'>
            <td class="attr-name">NKF_RELEASE_DATE</td>
            <td>=</td>
            <td class="attr-value">rb_str_new2(NKF_RELEASE_DATE)</td>
        </tr>
        
        <tr valign='top'>
            <td>&nbsp;</td>
            <td colspan="2" class="attr-desc"><p>
Release date of nkf
</p>
</td>
        </tr>
        
        
    </table>
    

    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M007186">
                    
                    <a name="M007186"></a><b>NKF.guess1(str)  &rarr; integer
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Returns guessed encoding of <em>str</em> as integer.
</p>
<p>
Algorithm described in: Ken Lunde. `Understanding Japanese Information
Processing&#8217; Sebastopol, CA: O&#8217;Reilly &amp; Associates.
</p>
<pre>
    case NKF.guess1(input)
    when NKF::JIS
      &quot;ISO-2022-JP&quot;
    when NKF::SJIS
      &quot;Shift_JIS&quot;
    when NKF::EUC
      &quot;EUC-JP&quot;
    when NKF::UNKNOWN
      &quot;UNKNOWN(ASCII)&quot;
    when NKF::BINARY
      &quot;BINARY&quot;
    end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007186_source')" id="l_M007186_source">show</a>
                        
                    </p>
                    <div id="M007186_source" class="dyn-source">
                        <pre>static VALUE
rb_nkf_guess1(obj, src)
  VALUE obj, src;
{
  unsigned char *p;
  unsigned char *pend;
  int sequence_counter = 0;

  StringValue(src);
  p = (unsigned char *)RSTRING(src)-&gt;ptr;
  pend = p + RSTRING(src)-&gt;len;
  if (p == pend) return INT2FIX(_UNKNOWN);

#define INCR do {\
      p++;\
      if (p==pend) return INT2FIX(_UNKNOWN);\
      sequence_counter++;\
      if (sequence_counter % 2 == 1 &amp;&amp; *p != 0xa4)\
        sequence_counter = 0;\
      if (6 &lt;= sequence_counter) {\
          sequence_counter = 0;\
          return INT2FIX(_EUC);\
      }\
  } while (0)

  if (*p == 0xa4)
    sequence_counter = 1;

  while (p&lt;pend) {
    if (*p == '\033') {
      return INT2FIX(_JIS);
    }
    if (*p &lt; '\006' || *p == 0x7f || *p == 0xff) {
      return INT2FIX(_BINARY);
    }
    if (0x81 &lt;= *p &amp;&amp; *p &lt;= 0x8d) {
      return INT2FIX(_SJIS);
    }
    if (0x8f &lt;= *p &amp;&amp; *p &lt;= 0x9f) {
      return INT2FIX(_SJIS);
    }
    if (*p == 0x8e) {   /* SS2 */
      INCR;
      if ((0x40 &lt;= *p &amp;&amp; *p &lt;= 0x7e) ||
          (0x80 &lt;= *p &amp;&amp; *p &lt;= 0xa0) ||
          (0xe0 &lt;= *p &amp;&amp; *p &lt;= 0xfc))
        return INT2FIX(_SJIS);
    }
    else if (0xa1 &lt;= *p &amp;&amp; *p &lt;= 0xdf) {
      INCR;
      if (0xf0 &lt;= *p &amp;&amp; *p &lt;= 0xfe)
        return INT2FIX(_EUC);
      if (0xe0 &lt;= *p &amp;&amp; *p &lt;= 0xef) {
        while (p &lt; pend &amp;&amp; *p &gt;= 0x40) {
          if (*p &gt;= 0x81) {
            if (*p &lt;= 0x8d || (0x8f &lt;= *p &amp;&amp; *p &lt;= 0x9f)) {
              return INT2FIX(_SJIS);
            }
            else if (0xfd &lt;= *p &amp;&amp; *p &lt;= 0xfe) {
              return INT2FIX(_EUC);
            }
          }
          INCR;
        }
      }
      else if (*p &lt;= 0x9f) {
        return INT2FIX(_SJIS);
      }
    }
    else if (0xf0 &lt;= *p &amp;&amp; *p &lt;= 0xfe) {
      return INT2FIX(_EUC);
    }
    else if (0xe0 &lt;= *p &amp;&amp; *p &lt;= 0xef) {
      INCR;
      if ((0x40 &lt;= *p &amp;&amp; *p &lt;= 0x7e) ||
          (0x80 &lt;= *p &amp;&amp; *p &lt;= 0xa0)) {
        return INT2FIX(_SJIS);
      }
      if (0xfd &lt;= *p &amp;&amp; *p &lt;= 0xfe) {
        return INT2FIX(_EUC);
      }
    }
    INCR;
  }
  return INT2FIX(_UNKNOWN);
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007187">
                    
                    <a name="M007187"></a><b>NKF.guess2(str)  &rarr; integer
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Returns guessed encoding of <em>str</em> as integer by nkf routine.
</p>
<pre>
   case NKF.guess(input)
   when NKF::ASCII
     &quot;ASCII&quot;
   when NKF::JIS
     &quot;ISO-2022-JP&quot;
   when NKF::SJIS
     &quot;Shift_JIS&quot;
   when NKF::EUC
     &quot;EUC-JP&quot;
   when NKF::UTF8
     &quot;UTF-8&quot;
   when NKF::UTF16
     &quot;UTF-16&quot;
   when NKF::UNKNOWN
     &quot;UNKNOWN&quot;
   when NKF::BINARY
     &quot;BINARY&quot;
   end
</pre>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007187_source')" id="l_M007187_source">show</a>
                        
                    </p>
                    <div id="M007187_source" class="dyn-source">
                        <pre>static VALUE
rb_nkf_guess2(obj, src)
  VALUE obj, src;
{
  int code = _BINARY;

  reinit();

  input_ctr = 0;
  StringValue(src);
  input = (unsigned char *)RSTRING(src)-&gt;ptr;
  i_len = RSTRING(src)-&gt;len;

  if(x0201_f == WISH_TRUE)
    x0201_f = ((!iso2022jp_f)? TRUE : NO_X0201);

  guess_f = TRUE;
  kanji_convert( NULL );
  guess_f = FALSE;

  if (!is_inputcode_mixed) {
    if (strcmp(input_codename, &quot;&quot;) == 0) {
      code = _ASCII;
    } else if (strcmp(input_codename, &quot;ISO-2022-JP&quot;) == 0) {
      code = _JIS;
    } else if (strcmp(input_codename, &quot;EUC-JP&quot;) == 0) {
      code = _EUC;
    } else if (strcmp(input_codename, &quot;Shift_JIS&quot;) == 0) {
      code = _SJIS;
    } else if (strcmp(input_codename, &quot;UTF-8&quot;) == 0) {
      code = _UTF8;
    } else if (strcmp(input_codename, &quot;UTF-16&quot;) == 0) {
      code = _UTF16;
    } else if (strlen(input_codename) &gt; 0) {
      code = _UNKNOWN;
    }
  }

  return INT2FIX( code );
}</pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M007185">
                    
                    <a name="M007185"></a><b>NKF.nkf(opt, str)   &rarr; string
</b>
                    
                </div>
                
                <div class="description">
                  <p>
Convert <em>str</em> and return converted result. Conversion details are
specified by <em>opt</em> as <a href="String.html">String</a>.
</p>
<pre>
   require 'nkf'
   output = NKF.nkf(&quot;-s&quot;, input)
</pre>
<p>
<b>Note</b> By default, nkf decodes MIME encoded string. If you want not to
decode input, use <a href="NKF.html#M007185">NKF.nkf</a> with <b>-m0</b>
flag.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M007185_source')" id="l_M007185_source">show</a>
                        
                    </p>
                    <div id="M007185_source" class="dyn-source">
                        <pre>static VALUE
rb_nkf_kconv(obj, opt, src)
  VALUE obj, opt, src;
{
  char *opt_ptr, *opt_end;
  volatile VALUE v;

  reinit();
  StringValue(opt);
  opt_ptr = RSTRING(opt)-&gt;ptr;
  opt_end = opt_ptr + RSTRING(opt)-&gt;len;
  nkf_split_options(opt_ptr);

  incsize = INCSIZE;

  input_ctr = 0;
  StringValue(src);
  input = (unsigned char *)RSTRING(src)-&gt;ptr;
  i_len = RSTRING(src)-&gt;len;
  result = rb_str_new(0, i_len*3 + 10);
  v = result;

  output_ctr = 0;
  output     = (unsigned char *)RSTRING(result)-&gt;ptr;
  o_len      = RSTRING(result)-&gt;len;
  *output    = '\0';

  if(x0201_f == WISH_TRUE)
    x0201_f = ((!iso2022jp_f)? TRUE : NO_X0201);

  kanji_convert(NULL);
  RSTRING(result)-&gt;ptr[output_ctr] = '\0';
  RSTRING(result)-&gt;len = output_ctr;
  OBJ_INFECT(result, src);

  return result;
}</pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    